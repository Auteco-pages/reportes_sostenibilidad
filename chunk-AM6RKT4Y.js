import{a as z}from"./chunk-2PSR7T7J.js";import{a as R,b as v,c as G,d as B,e as k,f as O,g as M,i as P,j as U,k as $,l as L,q as j,r as q,s as H,t as Y}from"./chunk-6S4UDF73.js";import{B as l,C as f,F as V,G as m,I as d,K as e,L as o,M as p,P as y,Q as g,R as c,S as n,T as C,U as _,W as I,a as x,b,c as h,da as N,ea as T,fa as D,ha as A,na as w,s as S,w as E,x as F}from"./chunk-ACHKL7EZ.js";function Q(r,u){if(r&1&&(e(0,"span",33),n(1),o()),r&2){let t=c().$implicit,a=c();l(),_(" ",a.getErrorMessage(t,"linea_accion")," ")}}function W(r,u){if(r&1&&(e(0,"span",33),n(1),o()),r&2){let t=c().$implicit,a=c();l(),_(" ",a.getErrorMessage(t,"nombre_voluntariado")," ")}}function X(r,u){if(r&1&&(e(0,"span",33),n(1),o()),r&2){let t=c().$implicit,a=c();l(),_(" ",a.getErrorMessage(t,"cantidad_voluntarios")," ")}}function Z(r,u){if(r&1&&(e(0,"span",33),n(1),o()),r&2){let t=c().$implicit,a=c();l(),_(" ",a.getErrorMessage(t,"cantidad_beneficiados")," ")}}function tt(r,u){if(r&1){let t=y();e(0,"button",34),g("click",function(){E(t);let i=c().index,s=c();return F(s.eliminarFilaVoluntariado(i))}),n(1," \u274C "),o()}}function et(r,u){if(r&1&&(e(0,"tr",25)(1,"td"),p(2,"input",26),m(3,Q,2,1,"span",27),o(),e(4,"td"),p(5,"input",28),m(6,W,2,1,"span",27),o(),e(7,"td"),p(8,"input",29),m(9,X,2,1,"span",27),o(),e(10,"td"),p(11,"input",30),m(12,Z,2,1,"span",27),o(),e(13,"td",31),m(14,tt,2,0,"button",32),o()()),r&2){let t=u.$implicit,a=u.index,i=c();d("formGroupName",a),l(2),d("ngClass",i.getFieldClass(t,"linea_accion")),l(),d("ngIf",i.shouldShowError(t,"linea_accion")),l(2),d("ngClass",i.getFieldClass(t,"nombre_voluntariado")),l(),d("ngIf",i.shouldShowError(t,"nombre_voluntariado")),l(2),d("ngClass",i.getFieldClass(t,"cantidad_voluntarios")),l(),d("ngIf",i.shouldShowError(t,"cantidad_voluntarios")),l(2),d("ngClass",i.getFieldClass(t,"cantidad_beneficiados")),l(),d("ngIf",i.shouldShowError(t,"cantidad_beneficiados")),l(2),d("ngIf",i.voluntariados.length>1)}}var ut=(()=>{class r extends H{constructor(t,a,i,s){super(),this.formBuilder=t,this.formService=a,this.formDataService=i,this.router=s,this.voluntariadoCorporativo=!0,this.datosvoluntariadocorporativo=new k({}),this.filesToUpload=new Map,this.totalVoluntarios=0,this.totalBeneficiados=0}ngOnInit(){this.datosvoluntariadocorporativo=this.formBuilder.group({voluntariados:this.formBuilder.array([])}),this.agregarFilaVoluntariado(),this.datosvoluntariadocorporativo.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get voluntariados(){return this.datosvoluntariadocorporativo.get("voluntariados")}agregarFilaVoluntariado(){let t=this.formBuilder.group({linea_accion:["",v.required],nombre_voluntariado:["",v.required],cantidad_voluntarios:["",[v.required,v.min(0)]],cantidad_beneficiados:["",[v.required,v.min(0)]]});t.valueChanges.subscribe(()=>this.calcularTotales()),this.voluntariados.push(t)}eliminarFilaVoluntariado(t){this.voluntariados.length>1&&(this.voluntariados.removeAt(t),this.calcularTotales())}calcularTotales(){this.totalVoluntarios=this.voluntariados.controls.reduce((t,a)=>t+(Number(a.get("cantidad_voluntarios")?.value)||0),0),this.totalBeneficiados=this.voluntariados.controls.reduce((t,a)=>t+(Number(a.get("cantidad_beneficiados")?.value)||0),0)}getNumericValue(t){return Number(this.datosvoluntariadocorporativo.get(t)?.value)||0}onFileSelected(t,a){let i=t.target.files[0];i&&(this.filesToUpload.set(a,i),console.log(`Archivo seleccionado: ${i.name} para ${a}`))}convertFileToBase64(t){return h(this,null,function*(){return new Promise((a,i)=>{let s=new FileReader;s.onload=()=>a(s.result),s.onerror=i,s.readAsDataURL(t)})})}submitFormVoluntariadoCorporativo(){return h(this,null,function*(){this.markFormGroupTouched(this.datosvoluntariadocorporativo),this.datosvoluntariadocorporativo.valid?(console.log("\u2705 Formulario Voluntariado Corporativo v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Voluntariado Corporativo inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return h(this,null,function*(){let t=[];for(let[s,J]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",s);let K=yield this.convertFileToBase64(J);t.push({fileName:s,fileData:K})}let a=this.formDataService.getDatosIniciales(),i=b(x({},this.datosvoluntariadocorporativo.value),{totales:{voluntarios:this.totalVoluntarios,beneficiados:this.totalBeneficiados},fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",i),this.formService.upload(t,a,null,null,null,null,null,null,null,null,null,null,null,null,null,i).subscribe({next:s=>{console.log("\u2705 Datos enviados exitosamente:",s),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:s=>{console.error("\u274C Error al enviar:",s),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(a){return new(a||r)(f(j),f(z),f(Y),f(w))}}static{this.\u0275cmp=S({type:r,selectors:[["app-voluntariado-corporativo"]],standalone:!0,features:[V,I],decls:58,vars:5,consts:[[1,"form-header"],[1,"header-content"],["src","assets/logo.png","alt","Logo Empresa",1,"logo-empresa"],[1,"header-text"],["id","msform"],[1,"border-purple",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","voluntariado-table"],[1,"acciones-col"],["formArrayName","voluntariados"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],["colspan","2",1,"total-label"],[1,"total-cell"],[1,"resultado-total"],[1,"resultado-total-final"],["type","button",1,"btn-agregar-fila",3,"click"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","linea_accion","placeholder","Ej: Educaci\xF3n, Medio Ambiente, etc.",3,"ngClass"],["class","error-text",4,"ngIf"],["type","text","formControlName","nombre_voluntariado","placeholder","Nombre de la actividad",3,"ngClass"],["type","number","formControlName","cantidad_voluntarios","placeholder","0",3,"ngClass"],["type","number","formControlName","cantidad_beneficiados","placeholder","0",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"]],template:function(a,i){a&1&&(e(0,"div",0)(1,"div",1),p(2,"img",2),e(3,"div",3)(4,"h1"),n(5,"Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),o(),e(6,"p"),n(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),o()()()(),e(8,"form",4)(9,"fieldset",5)(10,"form",6),g("ngSubmit",function(){return i.submitFormVoluntariadoCorporativo()}),e(11,"div",7)(12,"span",8),n(13,"\u{1F64B}"),o(),e(14,"h2"),n(15,"Programa de Voluntariado Corporativo"),o()(),e(16,"p",9),n(17," Complete la informaci\xF3n sobre programas de voluntariado corporativo y su impacto en las comunidades "),o(),e(18,"div",10)(19,"strong"),n(20,"\u2139\uFE0F INSTRUCCIONES:"),o(),n(21," Agregue filas seg\xFAn sea necesario para cada actividad de voluntariado. Los totales se calcular\xE1n autom\xE1ticamente. "),o(),e(22,"div",11)(23,"span",8),n(24,"\u{1F31F}"),o(),n(25," PROGRAMA DE VOLUNTARIADO CORPORATIVO - Contenido GRI: 413-1 "),o(),e(26,"h3",12),n(27,"Programas de desarrollo comunitario y relacionamiento con comunidades locales"),o(),e(28,"div",13)(29,"table",14)(30,"thead")(31,"tr")(32,"th"),n(33,"L\xEDnea de acci\xF3n"),o(),e(34,"th"),n(35,"Nombre del voluntariado"),o(),e(36,"th"),n(37,"Cantidad de voluntarios"),o(),e(38,"th"),n(39,"Cantidad de beneficiados"),o(),e(40,"th",15),n(41,"Acciones"),o()()(),e(42,"tbody",16),m(43,et,15,10,"tr",17),e(44,"tr",18)(45,"td",19)(46,"strong"),n(47,"Total"),o()(),e(48,"td",20)(49,"span",21),n(50),o()(),e(51,"td",20)(52,"span",22),n(53),o()(),p(54,"td"),o()()()(),e(55,"button",23),g("click",function(){return i.agregarFilaVoluntariado()}),n(56," \u2795 Agregar actividad de voluntariado "),o(),e(57,"input",24),g("click",function(){return i.submitFormVoluntariadoCorporativo()}),o()()()()),a&2&&(l(9),d("hidden",!i.voluntariadoCorporativo),l(),d("formGroup",i.datosvoluntariadocorporativo),l(33),d("ngForOf",i.voluntariados.controls),l(7),C(i.totalVoluntarios),l(3),C(i.totalBeneficiados))},dependencies:[A,N,T,D,q,O,R,M,G,B,P,L,U,$]})}}return r})();export{ut as VoluntariadoCorporativoComponent};
