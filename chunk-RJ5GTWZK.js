import{a as K}from"./chunk-2PSR7T7J.js";import{a as G,b as h,c as P,d as R,e as U,f as O,g as L,i as $,j,k as q,l as W,q as Y,r as H,s as z,t as J}from"./chunk-6S4UDF73.js";import{B as l,C as _,F as y,G as u,I as c,K as i,L as t,M as p,P as E,Q as f,R as m,S as a,T as I,U as g,W as B,Y as N,Z as T,a as b,b as S,c as C,da as M,ea as D,fa as k,ga as A,ha as V,na as w,s as F,w as v,x}from"./chunk-ACHKL7EZ.js";function Z(o,d){if(o&1&&(i(0,"span",34),a(1),t()),o&2){let e=m().$implicit,r=m();l(),g(" ",r.getErrorMessage(e,"marca")," ")}}function ee(o,d){if(o&1&&(i(0,"span",34),a(1),t()),o&2){let e=m().$implicit,r=m();l(),g(" ",r.getErrorMessage(e,"marketshare")," ")}}function te(o,d){if(o&1){let e=E();i(0,"button",35),f("click",function(){v(e);let n=m().index,s=m();return x(s.eliminarFilaParticipacion(n))}),a(1," \u274C "),t()}}function ie(o,d){if(o&1&&(i(0,"tr",28)(1,"td"),p(2,"input",29),u(3,Z,2,1,"span",30),t(),i(4,"td"),p(5,"input",31),u(6,ee,2,1,"span",30),t(),i(7,"td",32),u(8,te,2,0,"button",33),t()()),o&2){let e=d.$implicit,r=d.index,n=m();c("formGroupName",r),l(2),c("ngClass",n.getFieldClass(e,"marca")),l(),c("ngIf",n.shouldShowError(e,"marca")),l(2),c("ngClass",n.getFieldClass(e,"marketshare")),l(),c("ngIf",n.shouldShowError(e,"marketshare")),l(2),c("ngIf",n.participacionMercado.length>1)}}function ne(o,d){if(o&1&&(i(0,"span",34),a(1),t()),o&2){let e=m().$implicit,r=m();l(),g(" ",r.getErrorMessage(e,"segmento")," ")}}function ae(o,d){if(o&1&&(i(0,"span",34),a(1),t()),o&2){let e=m().$implicit,r=m();l(),g(" ",r.getErrorMessage(e,"modelo")," ")}}function re(o,d){if(o&1&&(i(0,"span",34),a(1),t()),o&2){let e=m().$implicit,r=m();l(),g(" ",r.getErrorMessage(e,"unidades_vendidas")," ")}}function oe(o,d){if(o&1){let e=E();i(0,"button",35),f("click",function(){v(e);let n=m().index,s=m();return x(s.eliminarFilaVentas(n))}),a(1," \u274C "),t()}}function le(o,d){if(o&1&&(i(0,"tr",28)(1,"td"),p(2,"input",36),u(3,ne,2,1,"span",30),t(),i(4,"td"),p(5,"input",37),u(6,ae,2,1,"span",30),t(),i(7,"td"),p(8,"input",38),u(9,re,2,1,"span",30),t(),i(10,"td",32),u(11,oe,2,0,"button",33),t()()),o&2){let e=d.$implicit,r=d.index,n=m();c("formGroupName",r),l(2),c("ngClass",n.getFieldClass(e,"segmento")),l(),c("ngIf",n.shouldShowError(e,"segmento")),l(2),c("ngClass",n.getFieldClass(e,"modelo")),l(),c("ngIf",n.shouldShowError(e,"modelo")),l(2),c("ngClass",n.getFieldClass(e,"unidades_vendidas")),l(),c("ngIf",n.shouldShowError(e,"unidades_vendidas")),l(2),c("ngIf",n.ventasModelo.length>1)}}var _e=(()=>{class o extends z{constructor(e,r,n,s){super(),this.formBuilder=e,this.formService=r,this.formDataService=n,this.router=s,this.comercialBlue=!0,this.datoscomercialblue=new U({}),this.filesToUpload=new Map,this.totalMarketshare=0,this.totalUnidadesVendidas=0}ngOnInit(){this.datoscomercialblue=this.formBuilder.group({participacion_mercado:this.formBuilder.array([]),ventas_modelo:this.formBuilder.array([])}),this.agregarFilaParticipacion(),this.agregarFilaVentas(),this.datoscomercialblue.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get participacionMercado(){return this.datoscomercialblue.get("participacion_mercado")}agregarFilaParticipacion(){let e=this.formBuilder.group({marca:["",h.required],marketshare:["",[h.required,h.min(0),h.max(100)]]});e.valueChanges.subscribe(()=>this.calcularTotales()),this.participacionMercado.push(e)}eliminarFilaParticipacion(e){this.participacionMercado.length>1&&(this.participacionMercado.removeAt(e),this.calcularTotales())}get ventasModelo(){return this.datoscomercialblue.get("ventas_modelo")}agregarFilaVentas(){let e=this.formBuilder.group({segmento:["",h.required],modelo:["",h.required],unidades_vendidas:["",[h.required,h.min(0)]]});e.valueChanges.subscribe(()=>this.calcularTotales()),this.ventasModelo.push(e)}eliminarFilaVentas(e){this.ventasModelo.length>1&&(this.ventasModelo.removeAt(e),this.calcularTotales())}calcularTotales(){this.totalMarketshare=this.participacionMercado.controls.reduce((e,r)=>e+(Number(r.get("marketshare")?.value)||0),0),this.totalUnidadesVendidas=this.ventasModelo.controls.reduce((e,r)=>e+(Number(r.get("unidades_vendidas")?.value)||0),0)}getNumericValue(e){return Number(this.datoscomercialblue.get(e)?.value)||0}onFileSelected(e,r){let n=e.target.files[0];n&&(this.filesToUpload.set(r,n),console.log(`Archivo seleccionado: ${n.name} para ${r}`))}convertFileToBase64(e){return C(this,null,function*(){return new Promise((r,n)=>{let s=new FileReader;s.onload=()=>r(s.result),s.onerror=n,s.readAsDataURL(e)})})}submitFormComercialBlue(){return C(this,null,function*(){this.markFormGroupTouched(this.datoscomercialblue),this.datoscomercialblue.valid?(console.log("\u2705 Formulario Comercial BLUE v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Comercial BLUE inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return C(this,null,function*(){let e=[];for(let[s,Q]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",s);let X=yield this.convertFileToBase64(Q);e.push({fileName:s,fileData:X})}let r=this.formDataService.getDatosIniciales(),n=S(b({},this.datoscomercialblue.value),{totales:{marketshare_total:this.totalMarketshare,unidades_vendidas_total:this.totalUnidadesVendidas},fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",n),this.formService.upload(e,r,null,null,null,null,null,null,null,null,null,null,null,null,null,null,n).subscribe({next:s=>{console.log("\u2705 Datos enviados exitosamente:",s),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:s=>{console.error("\u274C Error al enviar:",s),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(r){return new(r||o)(_(Y),_(K),_(J),_(w))}}static{this.\u0275cmp=F({type:o,selectors:[["app-comercial-blue"]],standalone:!0,features:[y,B],decls:82,vars:9,consts:[[1,"form-header"],[1,"header-content"],["src","assets/logo.png","alt","Logo Empresa",1,"logo-empresa"],[1,"header-text"],["id","msform"],[1,"border-blue",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","blue-table"],[1,"acciones-col"],["formArrayName","participacion_mercado"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],[1,"total-label"],[1,"total-cell"],[1,"resultado-total-final"],["type","button",1,"btn-agregar-fila",3,"click"],[1,"subsection-header",2,"margin-top","50px"],[1,"gri-table","blue-table-ventas"],["formArrayName","ventas_modelo"],["colspan","2",1,"total-label"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","marca","placeholder","Nombre de la marca",3,"ngClass"],["class","error-text",4,"ngIf"],["type","number","formControlName","marketshare","step","0.01","placeholder","0.00",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"],["type","text","formControlName","segmento","placeholder","Ej: SUV, Sed\xE1n, etc.",3,"ngClass"],["type","text","formControlName","modelo","placeholder","Nombre del modelo",3,"ngClass"],["type","number","formControlName","unidades_vendidas","placeholder","0",3,"ngClass"]],template:function(r,n){r&1&&(i(0,"div",0)(1,"div",1),p(2,"img",2),i(3,"div",3)(4,"h1"),a(5,"Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),t(),i(6,"p"),a(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),t()()()(),i(8,"form",4)(9,"fieldset",5)(10,"form",6),f("ngSubmit",function(){return n.submitFormComercialBlue()}),i(11,"div",7)(12,"span",8),a(13,"\u26A1"),t(),i(14,"h2"),a(15,"Participaci\xF3n en el Mercado El\xE9ctrico 4W+"),t()(),i(16,"p",9),a(17," Complete la informaci\xF3n sobre participaci\xF3n en el mercado de veh\xEDculos el\xE9ctricos y ventas por modelo "),t(),i(18,"div",10)(19,"strong"),a(20,"\u2139\uFE0F INSTRUCCIONES:"),t(),a(21," Agregue filas seg\xFAn sea necesario. Los totales se calcular\xE1n autom\xE1ticamente. "),t(),i(22,"div",11)(23,"span",8),a(24,"\u{1F4CA}"),t(),a(25," PARTICIPACI\xD3N EN EL MERCADO EL\xC9CTRICO 4W+ - Contenido GRI: N/A "),t(),i(26,"h3",12),a(27,"Participaci\xF3n en el mercado de veh\xEDculos el\xE9ctricos"),t(),i(28,"div",13)(29,"table",14)(30,"thead")(31,"tr")(32,"th"),a(33,"Marca"),t(),i(34,"th"),a(35,"Marketshare (%)"),t(),i(36,"th",15),a(37,"Acciones"),t()()(),i(38,"tbody",16),u(39,ie,9,6,"tr",17),i(40,"tr",18)(41,"td",19)(42,"strong"),a(43,"Total"),t()(),i(44,"td",20)(45,"span",21),a(46),N(47,"number"),t()(),p(48,"td"),t()()()(),i(49,"button",22),f("click",function(){return n.agregarFilaParticipacion()}),a(50," \u2795 Agregar marca "),t(),i(51,"div",23)(52,"span",8),a(53,"\u{1F697}"),t(),a(54," VENTAS POR MODELO Y SEGMENTO - Contenido GRI: N/A "),t(),i(55,"h3",12),a(56,"Ventas por modelo y segmento de veh\xEDculos el\xE9ctricos"),t(),i(57,"div",13)(58,"table",24)(59,"thead")(60,"tr")(61,"th"),a(62,"Segmento"),t(),i(63,"th"),a(64,"Modelo"),t(),i(65,"th"),a(66,"Unidades vendidas"),t(),i(67,"th",15),a(68,"Acciones"),t()()(),i(69,"tbody",25),u(70,le,12,8,"tr",17),i(71,"tr",18)(72,"td",26)(73,"strong"),a(74,"Total"),t()(),i(75,"td",20)(76,"span",21),a(77),t()(),p(78,"td"),t()()()(),i(79,"button",22),f("click",function(){return n.agregarFilaVentas()}),a(80," \u2795 Agregar modelo "),t(),i(81,"input",27),f("click",function(){return n.submitFormComercialBlue()}),t()()()()),r&2&&(l(9),c("hidden",!n.comercialBlue),l(),c("formGroup",n.datoscomercialblue),l(29),c("ngForOf",n.participacionMercado.controls),l(7),g("",T(47,6,n.totalMarketshare,"1.2-2"),"%"),l(24),c("ngForOf",n.ventasModelo.controls),l(7),I(n.totalUnidadesVendidas))},dependencies:[V,M,D,k,A,H,O,G,L,P,R,$,W,j,q]})}}return o})();export{_e as ComercialBlueComponent};
