import{a as K}from"./chunk-2PSR7T7J.js";import{a as T,b as f,c as A,d as w,e as U,f as B,g as G,i as k,j as M,k as V,l as $,m as L,n as q,o as j,r as z,s as H,t as Y,u as J}from"./chunk-IAQZ57CQ.js";import{B as a,C as _,F as D,G as u,I as s,K as i,L as t,M as h,P as b,Q as g,R as d,S as n,U as p,W as I,a as v,b as S,c as x,da as y,ea as P,fa as N,ha as O,na as R,s as E,w as C,x as F}from"./chunk-ACHKL7EZ.js";function X(r,m){if(r&1&&(i(0,"span",31),n(1),t()),r&2){let e=d().$implicit,l=d();a(),p(" ",l.getErrorMessage(e,"modelo")," ")}}function Z(r,m){if(r&1&&(i(0,"option",32),n(1),t()),r&2){let e=m.$implicit;s("value",e),a(),p(" ",e," ")}}function ee(r,m){if(r&1&&(i(0,"span",31),n(1),t()),r&2){let e=d().$implicit,l=d();a(),p(" ",l.getErrorMessage(e,"norma_euro")," ")}}function te(r,m){if(r&1&&(i(0,"option",32),n(1),t()),r&2){let e=m.$implicit;s("value",e),a(),p(" ",e," ")}}function oe(r,m){if(r&1&&(i(0,"span",31),n(1),t()),r&2){let e=d().$implicit,l=d();a(),p(" ",l.getErrorMessage(e,"sistema_frenado")," ")}}function ie(r,m){if(r&1&&(i(0,"option",32),n(1),t()),r&2){let e=m.$implicit;s("value",e),a(),p(" ",e," ")}}function re(r,m){if(r&1&&(i(0,"span",31),n(1),t()),r&2){let e=d().$implicit,l=d();a(),p(" ",l.getErrorMessage(e,"iluminacion")," ")}}function ne(r,m){if(r&1&&(i(0,"span",31),n(1),t()),r&2){let e=d().$implicit,l=d();a(),p(" ",l.getErrorMessage(e,"consumo_promedio")," ")}}function le(r,m){if(r&1){let e=b();i(0,"button",33),g("click",function(){C(e);let o=d().index,c=d();return F(c.eliminarFilaProducto(o))}),n(1," \u274C "),t()}}function ae(r,m){if(r&1&&(i(0,"tr",20)(1,"td"),h(2,"input",21),u(3,X,2,1,"span",22),t(),i(4,"td")(5,"select",23)(6,"option",24),n(7,"Seleccione..."),t(),u(8,Z,2,2,"option",25),t(),u(9,ee,2,1,"span",22),t(),i(10,"td")(11,"select",26)(12,"option",24),n(13,"Seleccione..."),t(),u(14,te,2,2,"option",25),t(),u(15,oe,2,1,"span",22),t(),i(16,"td")(17,"select",27)(18,"option",24),n(19,"Seleccione..."),t(),u(20,ie,2,2,"option",25),t(),u(21,re,2,1,"span",22),t(),i(22,"td"),h(23,"input",28),u(24,ne,2,1,"span",22),t(),i(25,"td",29),u(26,le,2,0,"button",30),t()()),r&2){let e=m.$implicit,l=m.index,o=d();s("formGroupName",l),a(2),s("ngClass",o.getFieldClass(e,"modelo")),a(),s("ngIf",o.shouldShowError(e,"modelo")),a(2),s("ngClass",o.getFieldClass(e,"norma_euro")),a(3),s("ngForOf",o.opcionesNormaEuro),a(),s("ngIf",o.shouldShowError(e,"norma_euro")),a(2),s("ngClass",o.getFieldClass(e,"sistema_frenado")),a(3),s("ngForOf",o.opcionesSistemaFrenado),a(),s("ngIf",o.shouldShowError(e,"sistema_frenado")),a(2),s("ngClass",o.getFieldClass(e,"iluminacion")),a(3),s("ngForOf",o.opcionesIluminacion),a(),s("ngIf",o.shouldShowError(e,"iluminacion")),a(2),s("ngClass",o.getFieldClass(e,"consumo_promedio")),a(),s("ngIf",o.shouldShowError(e,"consumo_promedio")),a(2),s("ngIf",o.productos.length>1)}}var xe=(()=>{class r extends Y{constructor(e,l,o,c){super(),this.formBuilder=e,this.formService=l,this.formDataService=o,this.router=c,this.desarrolloProducto=!0,this.datosdesarrolloproducto=new U({}),this.filesToUpload=new Map,this.opcionesNormaEuro=["EURO I","EURO II","EURO III","EURO VI","EURO V","EURO VI","No Aplica"],this.opcionesSistemaFrenado=["ABS","CBS","Sin ABS ni CBS"],this.opcionesIluminacion=["Luz de d\xEDa (DRL)","Luz siempre encendida (AHO)","Otra"]}ngOnInit(){this.datosdesarrolloproducto=this.formBuilder.group({productos:this.formBuilder.array([])}),this.agregarFilaProducto(),this.datosdesarrolloproducto.valueChanges.subscribe(()=>{})}get productos(){return this.datosdesarrolloproducto.get("productos")}agregarFilaProducto(){let e=this.formBuilder.group({modelo:["",f.required],norma_euro:["",f.required],sistema_frenado:["",f.required],iluminacion:["",f.required],consumo_promedio:["",[f.required,f.min(0)]]});this.productos.push(e)}eliminarFilaProducto(e){this.productos.length>1&&this.productos.removeAt(e)}getNumericValue(e){return Number(this.datosdesarrolloproducto.get(e)?.value)||0}onFileSelected(e,l){let o=e.target.files[0];o&&(this.filesToUpload.set(l,o),console.log(`Archivo seleccionado: ${o.name} para ${l}`))}convertFileToBase64(e){return x(this,null,function*(){return new Promise((l,o)=>{let c=new FileReader;c.onload=()=>l(c.result),c.onerror=o,c.readAsDataURL(e)})})}submitFormDesarrolloProducto(){return x(this,null,function*(){this.markFormGroupTouched(this.datosdesarrolloproducto),this.datosdesarrolloproducto.valid?(console.log("\u2705 Formulario Desarrollo de Producto v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Desarrollo de Producto inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return x(this,null,function*(){let e=[];for(let[c,Q]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",c);let W=yield this.convertFileToBase64(Q);e.push({fileName:c,fileData:W})}let l=this.formDataService.getDatosIniciales(),o=S(v({},this.datosdesarrolloproducto.value),{fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",o),this.formService.upload(e,l,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,o).subscribe({next:c=>{console.log("\u2705 Datos enviados exitosamente:",c),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:c=>{console.error("\u274C Error al enviar:",c),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(l){return new(l||r)(_(z),_(K),_(J),_(R))}}static{this.\u0275cmp=E({type:r,selectors:[["app-desarrollo-producto"]],standalone:!0,features:[D,I],decls:49,vars:3,consts:[[1,"form-header"],[1,"header-content"],[1,"header-text"],["src","assets/auteco-logo.png","alt","Logo Empresa",1,"logo-empresa"],["id","msform"],[1,"border-blue",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","producto-table"],[1,"acciones-col"],["formArrayName","productos"],[3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn-agregar-fila",3,"click"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","modelo","placeholder","Nombre del modelo",3,"ngClass"],["class","error-text",4,"ngIf"],["formControlName","norma_euro",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","sistema_frenado",3,"ngClass"],["formControlName","iluminacion",3,"ngClass"],["type","number","formControlName","consumo_promedio","step","0.01","placeholder","0.00",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],[3,"value"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"]],template:function(l,o){l&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),h(4,"img",3),n(5," Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),t(),i(6,"p"),n(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),t()()()(),i(8,"form",4)(9,"fieldset",5)(10,"form",6),g("ngSubmit",function(){return o.submitFormDesarrolloProducto()}),i(11,"div",7)(12,"span",8),n(13,"\u26A1"),t(),i(14,"h2"),n(15,"Desarrollo de Producto"),t()(),i(16,"p",9),n(17," Complete la informaci\xF3n sobre reducci\xF3n de requerimientos energ\xE9ticos de productos y servicios "),t(),i(18,"div",10)(19,"strong"),n(20,"\u2139\uFE0F INSTRUCCIONES:"),t(),n(21," Agregue filas para cada modelo de producto. Seleccione las opciones de las listas desplegables. "),t(),i(22,"div",11)(23,"span",8),n(24,"\u{1F50B}"),t(),n(25," DESARROLLO DE PRODUCTO - Contenido GRI: 302-5 "),t(),i(26,"h3",12),n(27,"Reducci\xF3n de los requerimientos energ\xE9ticos de productos y servicios"),t(),i(28,"div",13)(29,"table",14)(30,"thead")(31,"tr")(32,"th"),n(33,"MODELO"),t(),i(34,"th"),n(35,"NORMA EURO"),t(),i(36,"th"),n(37,"Sistema de frenado"),t(),i(38,"th"),n(39,"Iluminaci\xF3n"),t(),i(40,"th"),n(41,"Consumo promedio de combustible (l/km)"),t(),i(42,"th",15),n(43,"Acciones"),t()()(),i(44,"tbody",16),u(45,ae,27,15,"tr",17),t()()(),i(46,"button",18),g("click",function(){return o.agregarFilaProducto()}),n(47," \u2795 Agregar modelo de producto "),t(),i(48,"input",19),g("click",function(){return o.submitFormDesarrolloProducto()}),t()()()()),l&2&&(a(9),s("hidden",!o.desarrolloProducto),a(),s("formGroup",o.datosdesarrolloproducto),a(35),s("ngForOf",o.productos.controls))},dependencies:[O,y,P,N,H,B,q,j,T,G,L,A,w,k,$,M,V]})}}return r})();export{xe as DesarrolloProductoComponent};
