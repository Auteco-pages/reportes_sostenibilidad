import{a as J}from"./chunk-2PSR7T7J.js";import{a as V,b as c,c as M,d as L,e as R,f as q,g as G,i as k,j as P,k as O,l as B,q as U,r as $,s as Y,t as H}from"./chunk-6S4UDF73.js";import{B as r,C as g,F as T,G as p,I as s,K as t,L as e,M as S,P as v,Q as f,R as m,S as i,T as h,U as _,W as I,a as C,b as F,c as x,da as A,ea as N,fa as D,ha as j,na as w,s as y,w as E,x as b}from"./chunk-ACHKL7EZ.js";function Q(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m().$implicit,l=m();r(),_(" ",l.getErrorMessage(n,"mecanismo_formacion")," ")}}function W(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m().$implicit,l=m();r(),_(" ",l.getErrorMessage(n,"valor")," ")}}function X(o,u){if(o&1){let n=v();t(0,"button",43),f("click",function(){E(n);let a=m().index,d=m();return b(d.eliminarFilaFormacionSST(a))}),i(1," \u274C "),e()}}function Z(o,u){if(o&1&&(t(0,"tr",37)(1,"td"),S(2,"input",38),p(3,Q,2,1,"span",28),e(),t(4,"td"),S(5,"input",39),p(6,W,2,1,"span",28),e(),t(7,"td",40),p(8,X,2,0,"button",41),e()()),o&2){let n=u.$implicit,l=u.index,a=m();s("formGroupName",l),r(2),s("ngClass",a.getFieldClass(n,"mecanismo_formacion")),r(),s("ngIf",a.shouldShowError(n,"mecanismo_formacion")),r(2),s("ngClass",a.getFieldClass(n,"valor")),r(),s("ngIf",a.shouldShowError(n,"valor")),r(2),s("ngIf",a.formacionSST.length>1)}}function ee(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m().$implicit,l=m();r(),_(" ",l.getErrorMessage(n,"actividad_promocion")," ")}}function te(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m().$implicit,l=m();r(),_(" ",l.getErrorMessage(n,"valor")," ")}}function ie(o,u){if(o&1){let n=v();t(0,"button",43),f("click",function(){E(n);let a=m().index,d=m();return b(d.eliminarFilaPromocionSalud(a))}),i(1," \u274C "),e()}}function ne(o,u){if(o&1&&(t(0,"tr",37)(1,"td"),S(2,"input",44),p(3,ee,2,1,"span",28),e(),t(4,"td"),S(5,"input",39),p(6,te,2,1,"span",28),e(),t(7,"td",40),p(8,ie,2,0,"button",41),e()()),o&2){let n=u.$implicit,l=u.index,a=m();s("formGroupName",l),r(2),s("ngClass",a.getFieldClass(n,"actividad_promocion")),r(),s("ngIf",a.shouldShowError(n,"actividad_promocion")),r(2),s("ngClass",a.getFieldClass(n,"valor")),r(),s("ngIf",a.shouldShowError(n,"valor")),r(2),s("ngIf",a.promocionSalud.length>1)}}function ae(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"tasa_accidentalidad")," ")}}function oe(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"accidentes_mujeres")," ")}}function re(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"accidentes_hombres")," ")}}function le(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"lesiones_mujeres")," ")}}function se(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"lesiones_hombres")," ")}}function me(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"fallecimientos_mujeres")," ")}}function de(o,u){if(o&1&&(t(0,"span",42),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"fallecimientos_hombres")," ")}}var Ee=(()=>{class o extends Y{constructor(n,l,a,d){super(),this.formBuilder=n,this.formService=l,this.formDataService=a,this.router=d,this.sst=!0,this.datossst=new R({}),this.filesToUpload=new Map,this.totalFormacionSST=0,this.totalPromocionSalud=0,this.totalAccidentesLaborales=0,this.totalLesionesMayores=0,this.totalFallecimientos=0}ngOnInit(){this.datossst=this.formBuilder.group({formacion_sst:this.formBuilder.array([]),promocion_salud:this.formBuilder.array([]),tasa_accidentalidad:["",[c.required,c.min(0)]],accidentes_mujeres:["",[c.required,c.min(0)]],accidentes_hombres:["",[c.required,c.min(0)]],lesiones_mujeres:["",[c.required,c.min(0)]],lesiones_hombres:["",[c.required,c.min(0)]],fallecimientos_mujeres:["",[c.required,c.min(0)]],fallecimientos_hombres:["",[c.required,c.min(0)]]}),this.agregarFilaFormacionSST(),this.agregarFilaPromocionSalud(),this.datossst.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get formacionSST(){return this.datossst.get("formacion_sst")}agregarFilaFormacionSST(){let n=this.formBuilder.group({mecanismo_formacion:["",c.required],valor:["",[c.required,c.min(0)]]});n.valueChanges.subscribe(()=>this.calcularTotales()),this.formacionSST.push(n)}eliminarFilaFormacionSST(n){this.formacionSST.removeAt(n),this.calcularTotales()}get promocionSalud(){return this.datossst.get("promocion_salud")}agregarFilaPromocionSalud(){let n=this.formBuilder.group({actividad_promocion:["",c.required],valor:["",[c.required,c.min(0)]]});n.valueChanges.subscribe(()=>this.calcularTotales()),this.promocionSalud.push(n)}eliminarFilaPromocionSalud(n){this.promocionSalud.removeAt(n),this.calcularTotales()}calcularTotales(){this.totalFormacionSST=this.formacionSST.controls.reduce((n,l)=>n+(Number(l.get("valor")?.value)||0),0),this.totalPromocionSalud=this.promocionSalud.controls.reduce((n,l)=>n+(Number(l.get("valor")?.value)||0),0),this.totalAccidentesLaborales=this.getNumericValue("accidentes_mujeres")+this.getNumericValue("accidentes_hombres"),this.totalLesionesMayores=this.getNumericValue("lesiones_mujeres")+this.getNumericValue("lesiones_hombres"),this.totalFallecimientos=this.getNumericValue("fallecimientos_mujeres")+this.getNumericValue("fallecimientos_hombres")}getNumericValue(n){return Number(this.datossst.get(n)?.value)||0}onFileSelected(n,l){let a=n.target.files[0];a&&(this.filesToUpload.set(l,a),console.log(`Archivo seleccionado: ${a.name} para ${l}`))}convertFileToBase64(n){return x(this,null,function*(){return new Promise((l,a)=>{let d=new FileReader;d.onload=()=>l(d.result),d.onerror=a,d.readAsDataURL(n)})})}submitFormSST(){return x(this,null,function*(){this.markFormGroupTouched(this.datossst),this.datossst.valid?(console.log("\u2705 Formulario SST v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario SST inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return x(this,null,function*(){let n=[];for(let[d,z]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",d);let K=yield this.convertFileToBase64(z);n.push({fileName:d,fileData:K})}let l=this.formDataService.getDatosIniciales(),a=F(C({},this.datossst.value),{totales:{formacion_sst:this.totalFormacionSST,promocion_salud:this.totalPromocionSalud,accidentes_laborales:this.totalAccidentesLaborales,lesiones_mayores:this.totalLesionesMayores,fallecimientos:this.totalFallecimientos},fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",a),this.formService.upload(n,l,null,null,null,null,null,null,null,null,null,a).subscribe({next:d=>{console.log("\u2705 Datos enviados exitosamente:",d),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:d=>{console.error("\u274C Error al enviar:",d),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(l){return new(l||o)(g(U),g(J),g(H),g(w))}}static{this.\u0275cmp=y({type:o,selectors:[["app-sst"]],standalone:!0,features:[T,I],decls:208,vars:23,consts:[[1,"form-header"],[1,"header-content"],[1,"header-text"],["src","assets/auteco-logo.png","alt","Logo Empresa",1,"logo-empresa"],["id","msform"],[1,"border-purple",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","sst-table"],[1,"acciones-col"],["formArrayName","formacion_sst"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],[1,"total-label"],[1,"total-cell"],[1,"resultado-total"],["type","button",1,"btn-agregar-fila",3,"click"],[1,"subsection-header",2,"margin-top","50px"],["formArrayName","promocion_salud"],[1,"gri-table","sst-table-simple"],[1,"dato-label"],["type","number","formControlName","tasa_accidentalidad","step","0.01","placeholder","0.00",3,"ngClass"],["class","error-text",4,"ngIf"],[1,"table-subtitle",2,"margin-top","40px"],["type","number","formControlName","accidentes_mujeres","placeholder","0",3,"ngClass"],["type","number","formControlName","accidentes_hombres","placeholder","0",3,"ngClass"],["type","number","formControlName","lesiones_mujeres","placeholder","0",3,"ngClass"],["type","number","formControlName","lesiones_hombres","placeholder","0",3,"ngClass"],["type","number","formControlName","fallecimientos_mujeres","placeholder","0",3,"ngClass"],["type","number","formControlName","fallecimientos_hombres","placeholder","0",3,"ngClass"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","mecanismo_formacion","placeholder","Ej: Capacitaci\xF3n presencial, e-learning, etc.",3,"ngClass"],["type","number","formControlName","valor","placeholder","0",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"],["type","text","formControlName","actividad_promocion","placeholder","Ej: Jornadas de vacunaci\xF3n, programas de bienestar, etc.",3,"ngClass"]],template:function(l,a){l&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),S(4,"img",3),i(5," Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),e(),t(6,"p"),i(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),e()()()(),t(8,"form",4)(9,"fieldset",5)(10,"form",6),f("ngSubmit",function(){return a.submitFormSST()}),t(11,"div",7)(12,"span",8),i(13,"\u{1F3E5}"),e(),t(14,"h2"),i(15,"Seguridad y Salud en el Trabajo (SST)"),e()(),t(16,"p",9),i(17," Complete la informaci\xF3n sobre formaci\xF3n en SST, promoci\xF3n de la salud y accidentalidad laboral "),e(),t(18,"div",10)(19,"strong"),i(20,"\u2139\uFE0F INSTRUCCIONES:"),e(),i(21," Agregue filas seg\xFAn sea necesario para cada actividad. Los totales se calcular\xE1n autom\xE1ticamente. "),e(),t(22,"div",11)(23,"span",8),i(24,"\u{1F4DA}"),e(),i(25," FORMACI\xD3N DE COLABORADORES EN SST - Contenido GRI: 403-5 "),e(),t(26,"h3",12),i(27,"Formaci\xF3n de trabajadores sobre salud y seguridad en el trabajo"),e(),t(28,"div",13)(29,"table",14)(30,"thead")(31,"tr")(32,"th"),i(33,"Mecanismo de formaci\xF3n"),e(),t(34,"th"),i(35,"Valor"),e(),t(36,"th",15),i(37,"Acciones"),e()()(),t(38,"tbody",16),p(39,Z,9,6,"tr",17),t(40,"tr",18)(41,"td",19)(42,"strong"),i(43,"Total"),e()(),t(44,"td",20)(45,"span",21),i(46),e()(),S(47,"td"),e()()()(),t(48,"button",22),f("click",function(){return a.agregarFilaFormacionSST()}),i(49," \u2795 Agregar mecanismo de formaci\xF3n "),e(),t(50,"div",23)(51,"span",8),i(52,"\u{1F4AA}"),e(),i(53," ACTIVIDADES DE PROMOCI\xD3N A LA SALUD - Contenido GRI: 403-6 "),e(),t(54,"h3",12),i(55,"Programas de promoci\xF3n de la salud de colaboradores"),e(),t(56,"div",13)(57,"table",14)(58,"thead")(59,"tr")(60,"th"),i(61,"Actividades de promoci\xF3n de la salud"),e(),t(62,"th"),i(63,"Valor"),e(),t(64,"th",15),i(65,"Acciones"),e()()(),t(66,"tbody",24),p(67,ne,9,6,"tr",17),t(68,"tr",18)(69,"td",19)(70,"strong"),i(71,"Total"),e()(),t(72,"td",20)(73,"span",21),i(74),e()(),S(75,"td"),e()()()(),t(76,"button",22),f("click",function(){return a.agregarFilaPromocionSalud()}),i(77," \u2795 Agregar actividad de promoci\xF3n "),e(),t(78,"div",23)(79,"span",8),i(80,"\u26A0\uFE0F"),e(),i(81," ACCIDENTES Y FATALIDADES LABORALES - Contenido GRI: 403-9, 403-10 "),e(),t(82,"h3",12),i(83,"Tasa de accidentalidad laboral"),e(),t(84,"div",13)(85,"table",25)(86,"thead")(87,"tr")(88,"th"),i(89,"Actividades de promoci\xF3n de la salud"),e(),t(90,"th"),i(91,"Valor"),e()()(),t(92,"tbody")(93,"tr")(94,"td",26),i(95,"Tasa de accidentalidad laboral (%)"),e(),t(96,"td"),S(97,"input",27),p(98,ae,2,1,"span",28),e()()()()(),t(99,"h3",29),i(100,"Accidentalidad laboral"),e(),t(101,"div",13)(102,"table",25)(103,"thead")(104,"tr")(105,"th"),i(106,"Actividades de promoci\xF3n de la salud"),e(),t(107,"th"),i(108,"Valor"),e()()(),t(109,"tbody")(110,"tr")(111,"td",26),i(112,"N\xFAmero de colaboradoras "),t(113,"strong"),i(114,"mujeres"),e(),i(115," que sufrieron un accidente laboral"),e(),t(116,"td"),S(117,"input",30),p(118,oe,2,1,"span",28),e()(),t(119,"tr")(120,"td",26),i(121,"N\xFAmero de colaboradoras "),t(122,"strong"),i(123,"hombres"),e(),i(124," que sufrieron un accidente laboral"),e(),t(125,"td"),S(126,"input",31),p(127,re,2,1,"span",28),e()(),t(128,"tr",18)(129,"td",19)(130,"strong"),i(131,"Total"),e()(),t(132,"td",20)(133,"span",21),i(134),e()()()()()(),t(135,"h3",29),i(136,"Lesiones mayores"),e(),t(137,"div",13)(138,"table",25)(139,"thead")(140,"tr")(141,"th"),i(142,"Actividades de promoci\xF3n de la salud"),e(),t(143,"th"),i(144,"Valor"),e()()(),t(145,"tbody")(146,"tr")(147,"td",26),i(148,"N\xFAmero de colaboradoras "),t(149,"strong"),i(150,"mujeres"),e(),i(151," que sufrieron un accidente laboral y provoc\xF3 una discapacidad"),e(),t(152,"td"),S(153,"input",32),p(154,le,2,1,"span",28),e()(),t(155,"tr")(156,"td",26),i(157,"N\xFAmero de colaboradoras "),t(158,"strong"),i(159,"hombres"),e(),i(160," que sufrieron un accidente laboral y provoc\xF3 una discapacidad"),e(),t(161,"td"),S(162,"input",33),p(163,se,2,1,"span",28),e()(),t(164,"tr",18)(165,"td",19)(166,"strong"),i(167,"Total"),e()(),t(168,"td",20)(169,"span",21),i(170),e()()()()()(),t(171,"h3",29),i(172,"Fallecimientos"),e(),t(173,"div",13)(174,"table",25)(175,"thead")(176,"tr")(177,"th"),i(178,"Actividades de promoci\xF3n de la salud"),e(),t(179,"th"),i(180,"Valor"),e()()(),t(181,"tbody")(182,"tr")(183,"td",26),i(184,"N\xFAmero de colaboradoras "),t(185,"strong"),i(186,"mujeres"),e(),i(187," que sufrieron un accidente laboral y desencaden\xF3 un fallecimiento."),e(),t(188,"td"),S(189,"input",34),p(190,me,2,1,"span",28),e()(),t(191,"tr")(192,"td",26),i(193,"N\xFAmero de colaboradoras "),t(194,"strong"),i(195,"hombres"),e(),i(196," que sufrieron un accidente laboral y desencaden\xF3 un fallecimiento."),e(),t(197,"td"),S(198,"input",35),p(199,de,2,1,"span",28),e()(),t(200,"tr",18)(201,"td",19)(202,"strong"),i(203,"Total"),e()(),t(204,"td",20)(205,"span",21),i(206),e()()()()()(),t(207,"input",36),f("click",function(){return a.submitFormSST()}),e()()()()),l&2&&(r(9),s("hidden",!a.sst),r(),s("formGroup",a.datossst),r(29),s("ngForOf",a.formacionSST.controls),r(7),h(a.totalFormacionSST),r(21),s("ngForOf",a.promocionSalud.controls),r(7),h(a.totalPromocionSalud),r(23),s("ngClass",a.getFieldClass(a.datossst,"tasa_accidentalidad")),r(),s("ngIf",a.shouldShowError(a.datossst,"tasa_accidentalidad")),r(19),s("ngClass",a.getFieldClass(a.datossst,"accidentes_mujeres")),r(),s("ngIf",a.shouldShowError(a.datossst,"accidentes_mujeres")),r(8),s("ngClass",a.getFieldClass(a.datossst,"accidentes_hombres")),r(),s("ngIf",a.shouldShowError(a.datossst,"accidentes_hombres")),r(7),h(a.totalAccidentesLaborales),r(19),s("ngClass",a.getFieldClass(a.datossst,"lesiones_mujeres")),r(),s("ngIf",a.shouldShowError(a.datossst,"lesiones_mujeres")),r(8),s("ngClass",a.getFieldClass(a.datossst,"lesiones_hombres")),r(),s("ngIf",a.shouldShowError(a.datossst,"lesiones_hombres")),r(7),h(a.totalLesionesMayores),r(19),s("ngClass",a.getFieldClass(a.datossst,"fallecimientos_mujeres")),r(),s("ngIf",a.shouldShowError(a.datossst,"fallecimientos_mujeres")),r(8),s("ngClass",a.getFieldClass(a.datossst,"fallecimientos_hombres")),r(),s("ngIf",a.shouldShowError(a.datossst,"fallecimientos_hombres")),r(7),h(a.totalFallecimientos))},dependencies:[j,A,N,D,$,q,V,G,M,L,k,B,P,O]})}}return o})();export{Ee as SstComponent};
