import{a as K}from"./chunk-2PSR7T7J.js";import{a as O,b as l,c as B,d as k,e as w,f as q,g as U,i as L,j,k as P,l as $,q as H,r as Y,s as z,t as J}from"./chunk-6S4UDF73.js";import{B as o,C as b,F as N,G as g,I as r,K as t,L as e,M as m,P as f,Q as _,R as p,S as a,T as v,U as R,W as T,Y as F,Z as S,c as x,da as D,ea as A,fa as I,ga as V,ha as M,na as G,s as y,w as E,x as C}from"./chunk-ACHKL7EZ.js";function W(d,u){if(d&1){let n=f();t(0,"button",50),_("click",function(){E(n);let i=p().index,c=p();return C(c.eliminarFilaResiduosMetodo(i))}),a(1," \u274C "),e()}}function X(d,u){if(d&1&&(t(0,"tr",45)(1,"td"),m(2,"input",46),e(),t(3,"td"),m(4,"input",47),e(),t(5,"td",48),g(6,W,2,0,"button",49),e()()),d&2){let n=u.$implicit,s=u.index,i=p();r("formGroupName",s),o(2),r("ngClass",i.getFieldClass(n,"metodo_disposicion")),o(2),r("ngClass",i.getFieldClass(n,"residuos_generados")),o(2),r("ngIf",i.residuosMetodo.length>1)}}function Z(d,u){if(d&1){let n=f();t(0,"button",50),_("click",function(){E(n);let i=p().index,c=p();return C(c.eliminarFilaResiduosFamilia(i))}),a(1," \u274C "),e()}}function ee(d,u){if(d&1&&(t(0,"tr",45)(1,"td"),m(2,"input",46),e(),t(3,"td"),m(4,"input",47),e(),t(5,"td",48),g(6,Z,2,0,"button",49),e()()),d&2){let n=u.$implicit,s=u.index,i=p();r("formGroupName",s),o(2),r("ngClass",i.getFieldClass(n,"metodo_disposicion")),o(2),r("ngClass",i.getFieldClass(n,"residuos_generados")),o(2),r("ngIf",i.residuosFamilia.length>1)}}function te(d,u){if(d&1){let n=f();t(0,"button",50),_("click",function(){E(n);let i=p().index,c=p();return C(c.eliminarFilaEconomiaCircular(i))}),a(1," \u274C "),e()}}function ie(d,u){if(d&1&&(t(0,"tr",45)(1,"td"),m(2,"input",51),e(),t(3,"td"),m(4,"textarea",52),e(),t(5,"td"),m(6,"textarea",53),e(),t(7,"td",48),g(8,te,2,0,"button",49),e()()),d&2){let n=u.$implicit,s=u.index,i=p();r("formGroupName",s),o(2),r("ngClass",i.getFieldClass(n,"accion_implementada")),o(2),r("ngClass",i.getFieldClass(n,"descripcion_acciones")),o(2),r("ngClass",i.getFieldClass(n,"descripcion_resultados")),o(2),r("ngIf",i.accionesEconomiaCircular.length>1)}}function ae(d,u){if(d&1){let n=f();t(0,"button",50),_("click",function(){E(n);let i=p().index,c=p();return C(c.eliminarFilaGestionEnvases(i))}),a(1," \u274C "),e()}}function ne(d,u){if(d&1&&(t(0,"tr",45)(1,"td"),m(2,"input",54),e(),t(3,"td"),m(4,"input",55),e(),t(5,"td"),m(6,"input",56),e(),t(7,"td"),m(8,"input",57),e(),t(9,"td",48),g(10,ae,2,0,"button",49),e()()),d&2){let n=u.$implicit,s=u.index,i=p();r("formGroupName",s),o(2),r("ngClass",i.getFieldClass(n,"tipo_material")),o(2),r("ngClass",i.getFieldClass(n,"anio_base")),o(2),r("ngClass",i.getFieldClass(n,"cantidad_mercado")),o(2),r("ngClass",i.getFieldClass(n,"cantidad_recuperado")),o(2),r("ngIf",i.gestionEnvases.length>1)}}var _e=(()=>{class d extends z{constructor(n,s,i,c){super(),this.formBuilder=n,this.formService=s,this.formDataService=i,this.router=c,this.economiaCircular=!0,this.datoseconomiacircular=new w({}),this.filesToUpload=new Map,this.totalResiduosMetodo=0,this.totalResiduosFamilia=0,this.totalMaterialRecuperadoEnvases=0,this.totalUnidadesRecolectadas=0,this.porcentajeVariacionEmisiones=0}ngOnInit(){this.datoseconomiacircular=this.formBuilder.group({residuos_metodo:this.formBuilder.array([]),residuos_familia:this.formBuilder.array([]),acciones_economia_circular:this.formBuilder.array([]),gestion_envases:this.formBuilder.array([]),baterias_anio_base:["",[l.required,l.min(0)]],baterias_unidades_mercado:["",[l.required,l.min(0)]],baterias_unidades_recolectadas:["",[l.required,l.min(0)]],llantas_anio_base:["",[l.required,l.min(0)]],llantas_unidades_mercado:["",[l.required,l.min(0)]],llantas_unidades_recolectadas:["",[l.required,l.min(0)]],huella_carbono_2023:["",[l.required,l.min(0)]],huella_carbono_2024:["",[l.required,l.min(0)]]}),this.agregarFilaResiduosMetodo(),this.agregarFilaResiduosFamilia(),this.agregarFilaEconomiaCircular(),this.agregarFilaGestionEnvases(),this.datoseconomiacircular.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get residuosMetodo(){return this.datoseconomiacircular.get("residuos_metodo")}agregarFilaResiduosMetodo(){let n=this.formBuilder.group({metodo_disposicion:["",l.required],residuos_generados:["",[l.required,l.min(0)]]});n.valueChanges.subscribe(()=>this.calcularTotales()),this.residuosMetodo.push(n)}eliminarFilaResiduosMetodo(n){this.residuosMetodo.length>1&&(this.residuosMetodo.removeAt(n),this.calcularTotales())}get residuosFamilia(){return this.datoseconomiacircular.get("residuos_familia")}agregarFilaResiduosFamilia(){let n=this.formBuilder.group({metodo_disposicion:["",l.required],residuos_generados:["",[l.required,l.min(0)]]});n.valueChanges.subscribe(()=>this.calcularTotales()),this.residuosFamilia.push(n)}eliminarFilaResiduosFamilia(n){this.residuosFamilia.length>1&&(this.residuosFamilia.removeAt(n),this.calcularTotales())}get accionesEconomiaCircular(){return this.datoseconomiacircular.get("acciones_economia_circular")}agregarFilaEconomiaCircular(){let n=this.formBuilder.group({accion_implementada:["",l.required],descripcion_acciones:["",l.required],descripcion_resultados:["",l.required]});this.accionesEconomiaCircular.push(n)}eliminarFilaEconomiaCircular(n){this.accionesEconomiaCircular.length>1&&this.accionesEconomiaCircular.removeAt(n)}get gestionEnvases(){return this.datoseconomiacircular.get("gestion_envases")}agregarFilaGestionEnvases(){let n=this.formBuilder.group({tipo_material:["",l.required],anio_base:["",[l.required,l.min(0)]],cantidad_mercado:["",[l.required,l.min(0)]],cantidad_recuperado:["",[l.required,l.min(0)]]});n.valueChanges.subscribe(()=>this.calcularTotales()),this.gestionEnvases.push(n)}eliminarFilaGestionEnvases(n){this.gestionEnvases.length>1&&(this.gestionEnvases.removeAt(n),this.calcularTotales())}calcularTotales(){this.totalResiduosMetodo=0,this.residuosMetodo.controls.forEach(h=>{this.totalResiduosMetodo+=Number(h.get("residuos_generados")?.value)||0}),this.totalResiduosFamilia=0,this.residuosFamilia.controls.forEach(h=>{this.totalResiduosFamilia+=Number(h.get("residuos_generados")?.value)||0}),this.totalMaterialRecuperadoEnvases=0,this.gestionEnvases.controls.forEach(h=>{this.totalMaterialRecuperadoEnvases+=Number(h.get("cantidad_recuperado")?.value)||0});let n=this.getNumericValue("baterias_unidades_recolectadas"),s=this.getNumericValue("llantas_unidades_recolectadas");this.totalUnidadesRecolectadas=n+s;let i=this.getNumericValue("huella_carbono_2023"),c=this.getNumericValue("huella_carbono_2024");i>0?this.porcentajeVariacionEmisiones=(c-i)/i*100:this.porcentajeVariacionEmisiones=0}getNumericValue(n){let s=this.datoseconomiacircular.get(n)?.value;return Number(s)||0}onFileSelected(n,s){let i=n.target.files[0];i&&(this.filesToUpload.set(s,i),console.log(`Archivo seleccionado: ${i.name} para ${s}`))}convertFileToBase64(n){return x(this,null,function*(){return new Promise((s,i)=>{let c=new FileReader;c.onload=()=>s(c.result),c.onerror=i,c.readAsDataURL(n)})})}submitFormEconomiaCircular(){return x(this,null,function*(){this.markFormGroupTouched(this.datoseconomiacircular),this.datoseconomiacircular.valid?(console.log("\u2705 Formulario Econom\xEDa Circular v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Econom\xEDa Circular inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return x(this,null,function*(){let n=[];for(let[c,h]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",c);let Q=yield this.convertFileToBase64(h);n.push({fileName:c,fileData:Q})}let s=this.formDataService.getDatosIniciales(),i={residuos_por_metodo:{datos:this.datoseconomiacircular.value.residuos_metodo,totales:{total_residuos:this.totalResiduosMetodo}},familia_residuos:{datos:this.datoseconomiacircular.value.residuos_familia,totales:{total_residuos:this.totalResiduosFamilia}},acciones_economia_circular:{datos:this.datoseconomiacircular.value.acciones_economia_circular},gestion_posconsumo_envases:{datos:this.datoseconomiacircular.value.gestion_envases,totales:{total_material_recuperado:this.totalMaterialRecuperadoEnvases}},gestion_posconsumo_llantas_baterias:{baterias:{anio_base:this.getNumericValue("baterias_anio_base"),unidades_mercado:this.getNumericValue("baterias_unidades_mercado"),unidades_recolectadas:this.getNumericValue("baterias_unidades_recolectadas")},llantas:{anio_base:this.getNumericValue("llantas_anio_base"),unidades_mercado:this.getNumericValue("llantas_unidades_mercado"),unidades_recolectadas:this.getNumericValue("llantas_unidades_recolectadas")},totales:{total_unidades_recolectadas:this.totalUnidadesRecolectadas}},reduccion_emisiones:{huella_carbono_2023:this.getNumericValue("huella_carbono_2023"),huella_carbono_2024:this.getNumericValue("huella_carbono_2024"),porcentaje_variacion:this.porcentajeVariacionEmisiones},metadata:{fecha_reporte:new Date().toISOString(),formulario_completo:this.datoseconomiacircular.valid}};console.log("\u{1F4CA} Datos a enviar:",i),this.formService.upload(n,s,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,i).subscribe({next:c=>{console.log("\u2705 Datos enviados exitosamente:",c),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:c=>{console.error("\u274C Error al enviar:",c),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(s){return new(s||d)(b(H),b(K),b(J),b(G))}}static{this.\u0275cmp=y({type:d,selectors:[["app-economia-circular"]],standalone:!0,features:[N,T],decls:198,vars:31,consts:[[1,"form-header"],[1,"header-content"],["src","assets/logo.png","alt","Logo Empresa",1,"logo-empresa"],[1,"header-text"],["id","msform"],[1,"border-green",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","circular-table"],[1,"acciones-col"],["formArrayName","residuos_metodo"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],[1,"total-label"],[1,"total-cell"],[1,"resultado-total-final"],["type","button",1,"btn-agregar-fila",3,"click"],[1,"table-subtitle",2,"margin-top","50px"],["formArrayName","residuos_familia"],[1,"subsection-header",2,"margin-top","50px"],[1,"gri-table","circular-table-acciones"],["formArrayName","acciones_economia_circular"],[1,"gri-table","circular-table-envases"],["formArrayName","gestion_envases"],["colspan","3",1,"total-label"],[1,"table-subtitle",2,"margin-top","40px"],[1,"gri-table","circular-table-llantas"],[1,"dato-label"],["type","number","formControlName","baterias_anio_base","placeholder","A\xF1o",3,"ngClass"],["type","number","formControlName","baterias_unidades_mercado","placeholder","0",3,"ngClass"],["type","number","formControlName","baterias_unidades_recolectadas","placeholder","0",3,"ngClass"],["type","number","formControlName","llantas_anio_base","placeholder","A\xF1o",3,"ngClass"],["type","number","formControlName","llantas_unidades_mercado","placeholder","0",3,"ngClass"],["type","number","formControlName","llantas_unidades_recolectadas","placeholder","0",3,"ngClass"],[1,"gri-table","circular-table-reduccion"],["type","number","formControlName","huella_carbono_2023","step","0.01","placeholder","0.00",3,"ngClass"],["type","number","formControlName","huella_carbono_2024","step","0.01","placeholder","0.00",3,"ngClass"],[1,"valor-calculado"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","metodo_disposicion","placeholder","M\xE9todo de disposici\xF3n",3,"ngClass"],["type","number","formControlName","residuos_generados","step","0.01","placeholder","0.00",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"],["type","text","formControlName","accion_implementada","placeholder","Acci\xF3n implementada",3,"ngClass"],["formControlName","descripcion_acciones","placeholder","Descripci\xF3n de las acciones...","rows","3",3,"ngClass"],["formControlName","descripcion_resultados","placeholder","Descripci\xF3n de los resultados...","rows","3",3,"ngClass"],["type","text","formControlName","tipo_material","placeholder","Tipo de material",3,"ngClass"],["type","number","formControlName","anio_base","placeholder","A\xF1o",3,"ngClass"],["type","number","formControlName","cantidad_mercado","step","0.01","placeholder","0.00",3,"ngClass"],["type","number","formControlName","cantidad_recuperado","step","0.01","placeholder","0.00",3,"ngClass"]],template:function(s,i){s&1&&(t(0,"div",0)(1,"div",1),m(2,"img",2),t(3,"div",3)(4,"h1"),a(5,"Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),e(),t(6,"p"),a(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),e()()()(),t(8,"form",4)(9,"fieldset",5)(10,"form",6),_("ngSubmit",function(){return i.submitFormEconomiaCircular()}),t(11,"div",7)(12,"span",8),a(13,"\u267B\uFE0F"),e(),t(14,"h2"),a(15,"Gesti\xF3n Integral de Residuos S\xF3lidos"),e()(),t(16,"p",9),a(17," Complete la informaci\xF3n sobre gesti\xF3n de residuos, econom\xEDa circular y reducci\xF3n de emisiones "),e(),t(18,"div",10)(19,"strong"),a(20,"\u2139\uFE0F INSTRUCCIONES:"),e(),a(21," Complete todas las secciones sobre residuos, econom\xEDa circular y gesti\xF3n posconsumo. "),e(),t(22,"div",11)(23,"span",8),a(24,"\u{1F5D1}\uFE0F"),e(),a(25," GESTI\xD3N INTEGRAL DE RESIDUOS S\xD3LIDOS - Contenido GRI: 306-3, 306-4 "),e(),t(26,"h3",12),a(27,"Residuos generados por m\xE9todo de aprovechamiento y disposici\xF3n final"),e(),t(28,"div",13)(29,"table",14)(30,"thead")(31,"tr")(32,"th"),a(33,"M\xE9todo de disposici\xF3n final"),e(),t(34,"th"),a(35,"Residuos generados (TON)"),e(),t(36,"th",15),a(37,"Acciones"),e()()(),t(38,"tbody",16),g(39,X,7,4,"tr",17),t(40,"tr",18)(41,"td",19)(42,"strong"),a(43,"TOTAL"),e()(),t(44,"td",20)(45,"span",21),a(46),F(47,"number"),e()(),m(48,"td"),e()()()(),t(49,"button",22),_("click",function(){return i.agregarFilaResiduosMetodo()}),a(50," \u2795 Agregar m\xE9todo de disposici\xF3n "),e(),t(51,"h3",23),a(52,"Familia de residuos generados"),e(),t(53,"div",13)(54,"table",14)(55,"thead")(56,"tr")(57,"th"),a(58,"M\xE9todo de disposici\xF3n final"),e(),t(59,"th"),a(60,"Residuos generados (TON)"),e(),t(61,"th",15),a(62,"Acciones"),e()()(),t(63,"tbody",24),g(64,ee,7,4,"tr",17),t(65,"tr",18)(66,"td",19)(67,"strong"),a(68,"TOTAL"),e()(),t(69,"td",20)(70,"span",21),a(71),F(72,"number"),e()(),m(73,"td"),e()()()(),t(74,"button",22),_("click",function(){return i.agregarFilaResiduosFamilia()}),a(75," \u2795 Agregar familia de residuos "),e(),t(76,"div",25)(77,"span",8),a(78,"\u267B\uFE0F"),e(),a(79," ECONOM\xCDA CIRCULAR - Contenido GRI: 305-5 "),e(),t(80,"h3",12),a(81,"Acciones implementadas para promover la econom\xEDa circular (9Rs)"),e(),t(82,"div",13)(83,"table",26)(84,"thead")(85,"tr")(86,"th"),a(87,"Acci\xF3n implementada"),e(),t(88,"th"),a(89,"Descripci\xF3n de las acciones y su objetivo"),e(),t(90,"th"),a(91,"Descripci\xF3n de los resultados obtenidos"),e(),t(92,"th",15),a(93,"Acciones"),e()()(),t(94,"tbody",27),g(95,ie,9,5,"tr",17),e()()(),t(96,"button",22),_("click",function(){return i.agregarFilaEconomiaCircular()}),a(97," \u2795 Agregar acci\xF3n de econom\xEDa circular "),e(),t(98,"div",25)(99,"span",8),a(100,"\u{1F4E6}"),e(),a(101," GESTI\xD3N DE RESIDUOS POSCONSUMO - Contenido GRI: 301-3 "),e(),t(102,"h3",12),a(103,"Gesti\xF3n de Residuos Posconsumo (Envases, Empaques y RAEES)"),e(),t(104,"div",13)(105,"table",28)(106,"thead")(107,"tr")(108,"th"),a(109,"Tipo de material"),e(),t(110,"th"),a(111,"A\xF1o base (LB)"),e(),t(112,"th"),a(113,"Cantidad de material puesto en el mercado LB (TON CO2eq)"),e(),t(114,"th"),a(115,"Cantidad de material recuperado (TONCO2eq)"),e(),t(116,"th",15),a(117,"Acciones"),e()()(),t(118,"tbody",29),g(119,ne,11,6,"tr",17),t(120,"tr",18)(121,"td",30)(122,"strong"),a(123,"TOTAL"),e()(),t(124,"td",20)(125,"span",21),a(126),F(127,"number"),e()(),m(128,"td"),e()()()(),t(129,"button",22),_("click",function(){return i.agregarFilaGestionEnvases()}),a(130," \u2795 Agregar tipo de material "),e(),t(131,"h3",31),a(132,"Gesti\xF3n de Residuos Posconsumo (Llantas y Bater\xEDas plomo)"),e(),t(133,"div",13)(134,"table",32)(135,"thead")(136,"tr")(137,"th"),a(138,"Tipo de material"),e(),t(139,"th"),a(140,"A\xF1o base (LB)"),e(),t(141,"th"),a(142,"Unidades puestas en el mercado LB"),e(),t(143,"th"),a(144,"Cantidad de unidades recolectadas"),e()()(),t(145,"tbody")(146,"tr")(147,"td",33),a(148,"Bater\xEDas plomo\xE1cidas"),e(),t(149,"td"),m(150,"input",34),e(),t(151,"td"),m(152,"input",35),e(),t(153,"td"),m(154,"input",36),e()(),t(155,"tr")(156,"td",33),a(157,"Llantas"),e(),t(158,"td"),m(159,"input",37),e(),t(160,"td"),m(161,"input",38),e(),t(162,"td"),m(163,"input",39),e()(),t(164,"tr",18)(165,"td",30)(166,"strong"),a(167,"TOTAL"),e()(),t(168,"td",20)(169,"span",21),a(170),e()()()()()(),t(171,"div",25)(172,"span",8),a(173,"\u{1F4C9}"),e(),a(174," REDUCCI\xD3N DE EMISIONES - Contenido GRI: 305-5 "),e(),t(175,"h3",12),a(176,"Reducci\xF3n de las emisiones de GEI"),e(),t(177,"div",13)(178,"table",40)(179,"thead")(180,"tr")(181,"th"),a(182,"Huella de carbono 2023"),e(),t(183,"th"),a(184,"Huella de carbono 2024"),e(),t(185,"th"),a(186,"% de variaci\xF3n"),e()()(),t(187,"tbody")(188,"tr")(189,"td"),m(190,"input",41),e(),t(191,"td"),m(192,"input",42),e(),t(193,"td",43)(194,"span",21),a(195),F(196,"number"),e()()()()()(),t(197,"input",44),_("click",function(){return i.submitFormEconomiaCircular()}),e()()()()),s&2&&(o(9),r("hidden",!i.economiaCircular),o(),r("formGroup",i.datoseconomiacircular),o(29),r("ngForOf",i.residuosMetodo.controls),o(7),v(S(47,19,i.totalResiduosMetodo,"1.2-2")),o(18),r("ngForOf",i.residuosFamilia.controls),o(7),v(S(72,22,i.totalResiduosFamilia,"1.2-2")),o(24),r("ngForOf",i.accionesEconomiaCircular.controls),o(24),r("ngForOf",i.gestionEnvases.controls),o(7),v(S(127,25,i.totalMaterialRecuperadoEnvases,"1.2-2")),o(24),r("ngClass",i.getFieldClass(i.datoseconomiacircular,"baterias_anio_base")),o(2),r("ngClass",i.getFieldClass(i.datoseconomiacircular,"baterias_unidades_mercado")),o(2),r("ngClass",i.getFieldClass(i.datoseconomiacircular,"baterias_unidades_recolectadas")),o(5),r("ngClass",i.getFieldClass(i.datoseconomiacircular,"llantas_anio_base")),o(2),r("ngClass",i.getFieldClass(i.datoseconomiacircular,"llantas_unidades_mercado")),o(2),r("ngClass",i.getFieldClass(i.datoseconomiacircular,"llantas_unidades_recolectadas")),o(7),v(i.totalUnidadesRecolectadas),o(20),r("ngClass",i.getFieldClass(i.datoseconomiacircular,"huella_carbono_2023")),o(2),r("ngClass",i.getFieldClass(i.datoseconomiacircular,"huella_carbono_2024")),o(3),R("",S(196,28,i.porcentajeVariacionEmisiones,"1.1-1"),"%"))},dependencies:[M,D,A,I,V,Y,q,O,U,B,k,L,$,j,P]})}}return d})();export{_e as EconomiaCircularComponent};
