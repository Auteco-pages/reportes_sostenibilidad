import{a as Q}from"./chunk-2PSR7T7J.js";import{a as P,b as v,c as R,d as B,e as O,f as U,g as $,i as L,j,k as q,l as Y,q as H,r as z,s as J,t as K}from"./chunk-6S4UDF73.js";import{B as l,C as h,F,G as p,I as m,K as i,L as t,M as u,P as S,Q as f,R as c,S as a,T as y,U as g,W as I,Y as N,Z as M,a as E,b,c as _,da as D,ea as k,fa as A,ga as V,ha as w,na as G,s as T,w as C,x}from"./chunk-ACHKL7EZ.js";function Z(o,d){if(o&1&&(i(0,"span",35),a(1),t()),o&2){let e=c().$implicit,r=c();l(),g(" ",r.getErrorMessage(e,"marca")," ")}}function ee(o,d){if(o&1&&(i(0,"span",35),a(1),t()),o&2){let e=c().$implicit,r=c();l(),g(" ",r.getErrorMessage(e,"marketshare")," ")}}function te(o,d){if(o&1){let e=S();i(0,"button",36),f("click",function(){C(e);let n=c().index,s=c();return x(s.eliminarFilaParticipacion(n))}),a(1," \u274C "),t()}}function ie(o,d){if(o&1&&(i(0,"tr",29)(1,"td"),u(2,"input",30),p(3,Z,2,1,"span",31),t(),i(4,"td"),u(5,"input",32),p(6,ee,2,1,"span",31),t(),i(7,"td",33),p(8,te,2,0,"button",34),t()()),o&2){let e=d.$implicit,r=d.index,n=c();m("formGroupName",r),l(2),m("ngClass",n.getFieldClass(e,"marca")),l(),m("ngIf",n.shouldShowError(e,"marca")),l(2),m("ngClass",n.getFieldClass(e,"marketshare")),l(),m("ngIf",n.shouldShowError(e,"marketshare")),l(2),m("ngIf",n.participacionMercado.length>1)}}function ne(o,d){if(o&1&&(i(0,"span",35),a(1),t()),o&2){let e=c().$implicit,r=c();l(),g(" ",r.getErrorMessage(e,"segmento")," ")}}function ae(o,d){if(o&1&&(i(0,"span",35),a(1),t()),o&2){let e=c().$implicit,r=c();l(),g(" ",r.getErrorMessage(e,"modelo")," ")}}function re(o,d){if(o&1&&(i(0,"span",35),a(1),t()),o&2){let e=c().$implicit,r=c();l(),g(" ",r.getErrorMessage(e,"unidades_vendidas")," ")}}function oe(o,d){if(o&1){let e=S();i(0,"button",36),f("click",function(){C(e);let n=c().index,s=c();return x(s.eliminarFilaVentas(n))}),a(1," \u274C "),t()}}function le(o,d){if(o&1&&(i(0,"tr",29)(1,"td"),u(2,"input",37),p(3,ne,2,1,"span",31),t(),i(4,"td"),u(5,"input",38),p(6,ae,2,1,"span",31),t(),i(7,"td"),u(8,"input",39),p(9,re,2,1,"span",31),t(),i(10,"td",33),p(11,oe,2,0,"button",34),t()()),o&2){let e=d.$implicit,r=d.index,n=c();m("formGroupName",r),l(2),m("ngClass",n.getFieldClass(e,"segmento")),l(),m("ngIf",n.shouldShowError(e,"segmento")),l(2),m("ngClass",n.getFieldClass(e,"modelo")),l(),m("ngIf",n.shouldShowError(e,"modelo")),l(2),m("ngClass",n.getFieldClass(e,"unidades_vendidas")),l(),m("ngIf",n.shouldShowError(e,"unidades_vendidas")),l(2),m("ngIf",n.ventasModelo.length>1)}}var he=(()=>{class o extends J{constructor(e,r,n,s){super(),this.formBuilder=e,this.formService=r,this.formDataService=n,this.router=s,this.comercialTvs=!0,this.datoscomercialtvs=new O({}),this.filesToUpload=new Map,this.totalMarketshare=0,this.totalUnidadesVendidas=0}ngOnInit(){this.datoscomercialtvs=this.formBuilder.group({participacion_mercado:this.formBuilder.array([]),ventas_modelo:this.formBuilder.array([])}),this.agregarFilaParticipacion(),this.agregarFilaVentas(),this.datoscomercialtvs.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get participacionMercado(){return this.datoscomercialtvs.get("participacion_mercado")}agregarFilaParticipacion(){let e=this.formBuilder.group({marca:["",v.required],marketshare:["",[v.required,v.min(0),v.max(100)]]});e.valueChanges.subscribe(()=>this.calcularTotales()),this.participacionMercado.push(e)}eliminarFilaParticipacion(e){this.participacionMercado.length>1&&(this.participacionMercado.removeAt(e),this.calcularTotales())}get ventasModelo(){return this.datoscomercialtvs.get("ventas_modelo")}agregarFilaVentas(){let e=this.formBuilder.group({segmento:["",v.required],modelo:["",v.required],unidades_vendidas:["",[v.required,v.min(0)]]});e.valueChanges.subscribe(()=>this.calcularTotales()),this.ventasModelo.push(e)}eliminarFilaVentas(e){this.ventasModelo.length>1&&(this.ventasModelo.removeAt(e),this.calcularTotales())}calcularTotales(){this.totalMarketshare=this.participacionMercado.controls.reduce((e,r)=>e+(Number(r.get("marketshare")?.value)||0),0),this.totalUnidadesVendidas=this.ventasModelo.controls.reduce((e,r)=>e+(Number(r.get("unidades_vendidas")?.value)||0),0)}getNumericValue(e){return Number(this.datoscomercialtvs.get(e)?.value)||0}onFileSelected(e,r){let n=e.target.files[0];n&&(this.filesToUpload.set(r,n),console.log(`Archivo seleccionado: ${n.name} para ${r}`))}convertFileToBase64(e){return _(this,null,function*(){return new Promise((r,n)=>{let s=new FileReader;s.onload=()=>r(s.result),s.onerror=n,s.readAsDataURL(e)})})}submitFormComercialTvs(){return _(this,null,function*(){this.markFormGroupTouched(this.datoscomercialtvs),this.datoscomercialtvs.valid?(console.log("\u2705 Formulario Comercial TVS v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Comercial TVS inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return _(this,null,function*(){let e=[];for(let[s,W]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",s);let X=yield this.convertFileToBase64(W);e.push({fileName:s,fileData:X})}let r=this.formDataService.getDatosIniciales(),n=b(E({},this.datoscomercialtvs.value),{totales:{marketshare_total:this.totalMarketshare,unidades_vendidas_total:this.totalUnidadesVendidas},fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",n),this.formService.upload(e,r,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,n).subscribe({next:s=>{console.log("\u2705 Datos enviados exitosamente:",s),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:s=>{console.error("\u274C Error al enviar:",s),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(r){return new(r||o)(h(H),h(Q),h(K),h(G))}}static{this.\u0275cmp=T({type:o,selectors:[["app-comercial-tvs"]],standalone:!0,features:[F,I],decls:83,vars:9,consts:[[1,"form-header"],[1,"header-content"],["src","assets/logo.png","alt","Logo Empresa",1,"logo-empresa"],[1,"header-text"],["id","progressbar"],["id","msform"],[1,"border-tvs",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","tvs-table"],[1,"acciones-col"],["formArrayName","participacion_mercado"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],[1,"total-label"],[1,"total-cell"],[1,"resultado-total-final"],["type","button",1,"btn-agregar-fila",3,"click"],[1,"subsection-header",2,"margin-top","50px"],[1,"gri-table","tvs-table-ventas"],["formArrayName","ventas_modelo"],["colspan","2",1,"total-label"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","marca","placeholder","Nombre de la marca",3,"ngClass"],["class","error-text",4,"ngIf"],["type","number","formControlName","marketshare","step","0.01","placeholder","0.00",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"],["type","text","formControlName","segmento","placeholder","Ej: Sport, Scooter, etc.",3,"ngClass"],["type","text","formControlName","modelo","placeholder","Nombre del modelo",3,"ngClass"],["type","number","formControlName","unidades_vendidas","placeholder","0",3,"ngClass"]],template:function(r,n){r&1&&(i(0,"div",0)(1,"div",1),u(2,"img",2),i(3,"div",3)(4,"h1"),a(5,"Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),t(),i(6,"p"),a(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),t()()()(),u(8,"div",4),i(9,"form",5)(10,"fieldset",6)(11,"form",7),f("ngSubmit",function(){return n.submitFormComercialTvs()}),i(12,"div",8)(13,"span",9),a(14,"\u{1F3CD}\uFE0F"),t(),i(15,"h2"),a(16,"Participaci\xF3n en el Mercado de Combusti\xF3n"),t()(),i(17,"p",10),a(18," Complete la informaci\xF3n sobre participaci\xF3n en el mercado de motocicletas de combusti\xF3n y ventas por modelo "),t(),i(19,"div",11)(20,"strong"),a(21,"\u2139\uFE0F INSTRUCCIONES:"),t(),a(22," Agregue filas seg\xFAn sea necesario. Los totales se calcular\xE1n autom\xE1ticamente. "),t(),i(23,"div",12)(24,"span",9),a(25,"\u{1F4CA}"),t(),a(26," PARTICIPACI\xD3N EN EL MERCADO DE COMBUSTI\xD3N - Contenido GRI: N/A "),t(),i(27,"h3",13),a(28,"Participaci\xF3n en el mercado de combusti\xF3n"),t(),i(29,"div",14)(30,"table",15)(31,"thead")(32,"tr")(33,"th"),a(34,"Marca"),t(),i(35,"th"),a(36,"Marketshare (%)"),t(),i(37,"th",16),a(38,"Acciones"),t()()(),i(39,"tbody",17),p(40,ie,9,6,"tr",18),i(41,"tr",19)(42,"td",20)(43,"strong"),a(44,"Total"),t()(),i(45,"td",21)(46,"span",22),a(47),N(48,"number"),t()(),u(49,"td"),t()()()(),i(50,"button",23),f("click",function(){return n.agregarFilaParticipacion()}),a(51," \u2795 Agregar marca "),t(),i(52,"div",24)(53,"span",9),a(54,"\u{1F3C1}"),t(),a(55," VENTAS POR MODELO Y SEGMENTO - Contenido GRI: N/A "),t(),i(56,"h3",13),a(57,"Ventas por modelo y segmento de motocicletas"),t(),i(58,"div",14)(59,"table",25)(60,"thead")(61,"tr")(62,"th"),a(63,"Segmento"),t(),i(64,"th"),a(65,"Modelo"),t(),i(66,"th"),a(67,"Unidades vendidas"),t(),i(68,"th",16),a(69,"Acciones"),t()()(),i(70,"tbody",26),p(71,le,12,8,"tr",18),i(72,"tr",19)(73,"td",27)(74,"strong"),a(75,"Total"),t()(),i(76,"td",21)(77,"span",22),a(78),t()(),u(79,"td"),t()()()(),i(80,"button",23),f("click",function(){return n.agregarFilaVentas()}),a(81," \u2795 Agregar modelo "),t(),i(82,"input",28),f("click",function(){return n.submitFormComercialTvs()}),t()()()()),r&2&&(l(10),m("hidden",!n.comercialTvs),l(),m("formGroup",n.datoscomercialtvs),l(29),m("ngForOf",n.participacionMercado.controls),l(7),g("",M(48,6,n.totalMarketshare,"1.2-2"),"%"),l(24),m("ngForOf",n.ventasModelo.controls),l(7),y(n.totalUnidadesVendidas))},dependencies:[w,D,k,A,V,z,U,P,$,R,B,L,Y,j,q]})}}return o})();export{he as ComercialTvsComponent};
