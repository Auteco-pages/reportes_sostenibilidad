import{a as J}from"./chunk-2PSR7T7J.js";import{a as T,b as f,c as A,d as w,e as U,f as B,g as G,i as M,j as k,k as V,l as $,m as L,n as q,o as j,q as z,r as H,s as W,t as Y}from"./chunk-6S4UDF73.js";import{B as a,C as _,F as b,G as p,I as s,K as o,L as t,M as g,P as D,Q as x,R as d,S as n,U as u,W as I,a as h,b as S,c as v,da as y,ea as P,fa as N,ha as O,na as R,s as E,w as C,x as F}from"./chunk-ACHKL7EZ.js";function X(r,m){if(r&1&&(o(0,"span",32),n(1),t()),r&2){let e=d().$implicit,l=d();a(),u(" ",l.getErrorMessage(e,"modelo")," ")}}function Z(r,m){if(r&1&&(o(0,"option",33),n(1),t()),r&2){let e=m.$implicit;s("value",e),a(),u(" ",e," ")}}function ee(r,m){if(r&1&&(o(0,"span",32),n(1),t()),r&2){let e=d().$implicit,l=d();a(),u(" ",l.getErrorMessage(e,"norma_euro")," ")}}function te(r,m){if(r&1&&(o(0,"option",33),n(1),t()),r&2){let e=m.$implicit;s("value",e),a(),u(" ",e," ")}}function oe(r,m){if(r&1&&(o(0,"span",32),n(1),t()),r&2){let e=d().$implicit,l=d();a(),u(" ",l.getErrorMessage(e,"sistema_frenado")," ")}}function ie(r,m){if(r&1&&(o(0,"option",33),n(1),t()),r&2){let e=m.$implicit;s("value",e),a(),u(" ",e," ")}}function re(r,m){if(r&1&&(o(0,"span",32),n(1),t()),r&2){let e=d().$implicit,l=d();a(),u(" ",l.getErrorMessage(e,"iluminacion")," ")}}function ne(r,m){if(r&1&&(o(0,"span",32),n(1),t()),r&2){let e=d().$implicit,l=d();a(),u(" ",l.getErrorMessage(e,"consumo_promedio")," ")}}function le(r,m){if(r&1){let e=D();o(0,"button",34),x("click",function(){C(e);let i=d().index,c=d();return F(c.eliminarFilaProducto(i))}),n(1," \u274C "),t()}}function ae(r,m){if(r&1&&(o(0,"tr",21)(1,"td"),g(2,"input",22),p(3,X,2,1,"span",23),t(),o(4,"td")(5,"select",24)(6,"option",25),n(7,"Seleccione..."),t(),p(8,Z,2,2,"option",26),t(),p(9,ee,2,1,"span",23),t(),o(10,"td")(11,"select",27)(12,"option",25),n(13,"Seleccione..."),t(),p(14,te,2,2,"option",26),t(),p(15,oe,2,1,"span",23),t(),o(16,"td")(17,"select",28)(18,"option",25),n(19,"Seleccione..."),t(),p(20,ie,2,2,"option",26),t(),p(21,re,2,1,"span",23),t(),o(22,"td"),g(23,"input",29),p(24,ne,2,1,"span",23),t(),o(25,"td",30),p(26,le,2,0,"button",31),t()()),r&2){let e=m.$implicit,l=m.index,i=d();s("formGroupName",l),a(2),s("ngClass",i.getFieldClass(e,"modelo")),a(),s("ngIf",i.shouldShowError(e,"modelo")),a(2),s("ngClass",i.getFieldClass(e,"norma_euro")),a(3),s("ngForOf",i.opcionesNormaEuro),a(),s("ngIf",i.shouldShowError(e,"norma_euro")),a(2),s("ngClass",i.getFieldClass(e,"sistema_frenado")),a(3),s("ngForOf",i.opcionesSistemaFrenado),a(),s("ngIf",i.shouldShowError(e,"sistema_frenado")),a(2),s("ngClass",i.getFieldClass(e,"iluminacion")),a(3),s("ngForOf",i.opcionesIluminacion),a(),s("ngIf",i.shouldShowError(e,"iluminacion")),a(2),s("ngClass",i.getFieldClass(e,"consumo_promedio")),a(),s("ngIf",i.shouldShowError(e,"consumo_promedio")),a(2),s("ngIf",i.productos.length>1)}}var xe=(()=>{class r extends W{constructor(e,l,i,c){super(),this.formBuilder=e,this.formService=l,this.formDataService=i,this.router=c,this.desarrolloProducto=!0,this.datosdesarrolloproducto=new U({}),this.filesToUpload=new Map,this.opcionesNormaEuro=["EURO I","EURO II","EURO III","EURO VI","EURO V","EURO VI"],this.opcionesSistemaFrenado=["ABS","CBS","Sin ABS ni CBS"],this.opcionesIluminacion=["Luz de d\xEDa (DRL)","Luz siempre encendida (AHO)","Otra"]}ngOnInit(){this.datosdesarrolloproducto=this.formBuilder.group({productos:this.formBuilder.array([])}),this.agregarFilaProducto(),this.datosdesarrolloproducto.valueChanges.subscribe(()=>{})}get productos(){return this.datosdesarrolloproducto.get("productos")}agregarFilaProducto(){let e=this.formBuilder.group({modelo:["",f.required],norma_euro:["",f.required],sistema_frenado:["",f.required],iluminacion:["",f.required],consumo_promedio:["",[f.required,f.min(0)]]});this.productos.push(e)}eliminarFilaProducto(e){this.productos.length>1&&this.productos.removeAt(e)}getNumericValue(e){return Number(this.datosdesarrolloproducto.get(e)?.value)||0}onFileSelected(e,l){let i=e.target.files[0];i&&(this.filesToUpload.set(l,i),console.log(`Archivo seleccionado: ${i.name} para ${l}`))}convertFileToBase64(e){return v(this,null,function*(){return new Promise((l,i)=>{let c=new FileReader;c.onload=()=>l(c.result),c.onerror=i,c.readAsDataURL(e)})})}submitFormDesarrolloProducto(){return v(this,null,function*(){this.markFormGroupTouched(this.datosdesarrolloproducto),this.datosdesarrolloproducto.valid?(console.log("\u2705 Formulario Desarrollo de Producto v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Desarrollo de Producto inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return v(this,null,function*(){let e=[];for(let[c,K]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",c);let Q=yield this.convertFileToBase64(K);e.push({fileName:c,fileData:Q})}let l=this.formDataService.getDatosIniciales(),i=S(h({},this.datosdesarrolloproducto.value),{fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",i),this.formService.upload(e,l,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,i).subscribe({next:c=>{console.log("\u2705 Datos enviados exitosamente:",c),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:c=>{console.error("\u274C Error al enviar:",c),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(l){return new(l||r)(_(z),_(J),_(Y),_(R))}}static{this.\u0275cmp=E({type:r,selectors:[["app-desarrollo-producto"]],standalone:!0,features:[b,I],decls:50,vars:3,consts:[[1,"form-header"],[1,"header-content"],["src","assets/logo.png","alt","Logo Empresa",1,"logo-empresa"],[1,"header-text"],["id","progressbar"],["id","msform"],[1,"border-blue",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","producto-table"],[1,"acciones-col"],["formArrayName","productos"],[3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn-agregar-fila",3,"click"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","modelo","placeholder","Nombre del modelo",3,"ngClass"],["class","error-text",4,"ngIf"],["formControlName","norma_euro",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","sistema_frenado",3,"ngClass"],["formControlName","iluminacion",3,"ngClass"],["type","number","formControlName","consumo_promedio","step","0.01","placeholder","0.00",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],[3,"value"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"]],template:function(l,i){l&1&&(o(0,"div",0)(1,"div",1),g(2,"img",2),o(3,"div",3)(4,"h1"),n(5,"Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),t(),o(6,"p"),n(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),t()()()(),g(8,"div",4),o(9,"form",5)(10,"fieldset",6)(11,"form",7),x("ngSubmit",function(){return i.submitFormDesarrolloProducto()}),o(12,"div",8)(13,"span",9),n(14,"\u26A1"),t(),o(15,"h2"),n(16,"Participaci\xF3n en el Mercado El\xE9ctrico 4W+"),t()(),o(17,"p",10),n(18," Complete la informaci\xF3n sobre reducci\xF3n de requerimientos energ\xE9ticos de productos y servicios "),t(),o(19,"div",11)(20,"strong"),n(21,"\u2139\uFE0F INSTRUCCIONES:"),t(),n(22," Agregue filas para cada modelo de producto. Seleccione las opciones de las listas desplegables. "),t(),o(23,"div",12)(24,"span",9),n(25,"\u{1F50B}"),t(),n(26," DESARROLLO DE PRODUCTO - Contenido GRI: 302-5 "),t(),o(27,"h3",13),n(28,"Reducci\xF3n de los requerimientos energ\xE9ticos de productos y servicios"),t(),o(29,"div",14)(30,"table",15)(31,"thead")(32,"tr")(33,"th"),n(34,"MODELO"),t(),o(35,"th"),n(36,"NORMA EURO"),t(),o(37,"th"),n(38,"Sistema de frenado"),t(),o(39,"th"),n(40,"Iluminaci\xF3n"),t(),o(41,"th"),n(42,"Consumo promedio de combustible (l/km)"),t(),o(43,"th",16),n(44,"Acciones"),t()()(),o(45,"tbody",17),p(46,ae,27,15,"tr",18),t()()(),o(47,"button",19),x("click",function(){return i.agregarFilaProducto()}),n(48," \u2795 Agregar modelo de producto "),t(),o(49,"input",20),x("click",function(){return i.submitFormDesarrolloProducto()}),t()()()()),l&2&&(a(10),s("hidden",!i.desarrolloProducto),a(),s("formGroup",i.datosdesarrolloproducto),a(35),s("ngForOf",i.productos.controls))},dependencies:[O,y,P,N,H,B,q,j,T,G,L,A,w,M,$,k,V]})}}return r})();export{xe as DesarrolloProductoComponent};
