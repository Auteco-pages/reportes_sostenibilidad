import{a as Q}from"./chunk-2PSR7T7J.js";import{a as P,b as v,c as R,d as B,e as O,f as U,g as $,i as L,j,k as q,l as Y,q as H,r as z,s as J,t as K}from"./chunk-6S4UDF73.js";import{B as l,C as g,F,G as p,I as m,K as i,L as t,M as u,P as S,Q as f,R as c,S as a,T as y,U as h,W as I,Y as N,Z as M,a as E,b,c as _,da as D,ea as k,fa as A,ga as V,ha as w,na as G,s as T,w as C,x}from"./chunk-ACHKL7EZ.js";function Z(r,d){if(r&1&&(i(0,"span",34),a(1),t()),r&2){let e=c().$implicit,o=c();l(),h(" ",o.getErrorMessage(e,"marca")," ")}}function ee(r,d){if(r&1&&(i(0,"span",34),a(1),t()),r&2){let e=c().$implicit,o=c();l(),h(" ",o.getErrorMessage(e,"marketshare")," ")}}function te(r,d){if(r&1){let e=S();i(0,"button",35),f("click",function(){C(e);let n=c().index,s=c();return x(s.eliminarFilaParticipacion(n))}),a(1," \u274C "),t()}}function ie(r,d){if(r&1&&(i(0,"tr",28)(1,"td"),u(2,"input",29),p(3,Z,2,1,"span",30),t(),i(4,"td"),u(5,"input",31),p(6,ee,2,1,"span",30),t(),i(7,"td",32),p(8,te,2,0,"button",33),t()()),r&2){let e=d.$implicit,o=d.index,n=c();m("formGroupName",o),l(2),m("ngClass",n.getFieldClass(e,"marca")),l(),m("ngIf",n.shouldShowError(e,"marca")),l(2),m("ngClass",n.getFieldClass(e,"marketshare")),l(),m("ngIf",n.shouldShowError(e,"marketshare")),l(2),m("ngIf",n.participacionMercado.length>1)}}function ne(r,d){if(r&1&&(i(0,"span",34),a(1),t()),r&2){let e=c().$implicit,o=c();l(),h(" ",o.getErrorMessage(e,"segmento")," ")}}function ae(r,d){if(r&1&&(i(0,"span",34),a(1),t()),r&2){let e=c().$implicit,o=c();l(),h(" ",o.getErrorMessage(e,"modelo")," ")}}function oe(r,d){if(r&1&&(i(0,"span",34),a(1),t()),r&2){let e=c().$implicit,o=c();l(),h(" ",o.getErrorMessage(e,"unidades_vendidas")," ")}}function re(r,d){if(r&1){let e=S();i(0,"button",35),f("click",function(){C(e);let n=c().index,s=c();return x(s.eliminarFilaVentas(n))}),a(1," \u274C "),t()}}function le(r,d){if(r&1&&(i(0,"tr",28)(1,"td"),u(2,"input",36),p(3,ne,2,1,"span",30),t(),i(4,"td"),u(5,"input",37),p(6,ae,2,1,"span",30),t(),i(7,"td"),u(8,"input",38),p(9,oe,2,1,"span",30),t(),i(10,"td",32),p(11,re,2,0,"button",33),t()()),r&2){let e=d.$implicit,o=d.index,n=c();m("formGroupName",o),l(2),m("ngClass",n.getFieldClass(e,"segmento")),l(),m("ngIf",n.shouldShowError(e,"segmento")),l(2),m("ngClass",n.getFieldClass(e,"modelo")),l(),m("ngIf",n.shouldShowError(e,"modelo")),l(2),m("ngClass",n.getFieldClass(e,"unidades_vendidas")),l(),m("ngIf",n.shouldShowError(e,"unidades_vendidas")),l(2),m("ngIf",n.ventasModelo.length>1)}}var ge=(()=>{class r extends J{constructor(e,o,n,s){super(),this.formBuilder=e,this.formService=o,this.formDataService=n,this.router=s,this.comercialTvs=!0,this.datoscomercialtvs=new O({}),this.filesToUpload=new Map,this.totalMarketshare=0,this.totalUnidadesVendidas=0}ngOnInit(){this.datoscomercialtvs=this.formBuilder.group({participacion_mercado:this.formBuilder.array([]),ventas_modelo:this.formBuilder.array([])}),this.agregarFilaParticipacion(),this.agregarFilaVentas(),this.datoscomercialtvs.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get participacionMercado(){return this.datoscomercialtvs.get("participacion_mercado")}agregarFilaParticipacion(){let e=this.formBuilder.group({marca:["",v.required],marketshare:["",[v.required,v.min(0),v.max(100)]]});e.valueChanges.subscribe(()=>this.calcularTotales()),this.participacionMercado.push(e)}eliminarFilaParticipacion(e){this.participacionMercado.length>1&&(this.participacionMercado.removeAt(e),this.calcularTotales())}get ventasModelo(){return this.datoscomercialtvs.get("ventas_modelo")}agregarFilaVentas(){let e=this.formBuilder.group({segmento:["",v.required],modelo:["",v.required],unidades_vendidas:["",[v.required,v.min(0)]]});e.valueChanges.subscribe(()=>this.calcularTotales()),this.ventasModelo.push(e)}eliminarFilaVentas(e){this.ventasModelo.length>1&&(this.ventasModelo.removeAt(e),this.calcularTotales())}calcularTotales(){this.totalMarketshare=this.participacionMercado.controls.reduce((e,o)=>e+(Number(o.get("marketshare")?.value)||0),0),this.totalUnidadesVendidas=this.ventasModelo.controls.reduce((e,o)=>e+(Number(o.get("unidades_vendidas")?.value)||0),0)}getNumericValue(e){return Number(this.datoscomercialtvs.get(e)?.value)||0}onFileSelected(e,o){let n=e.target.files[0];n&&(this.filesToUpload.set(o,n),console.log(`Archivo seleccionado: ${n.name} para ${o}`))}convertFileToBase64(e){return _(this,null,function*(){return new Promise((o,n)=>{let s=new FileReader;s.onload=()=>o(s.result),s.onerror=n,s.readAsDataURL(e)})})}submitFormComercialTvs(){return _(this,null,function*(){this.markFormGroupTouched(this.datoscomercialtvs),this.datoscomercialtvs.valid?(console.log("\u2705 Formulario Comercial TVS v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Comercial TVS inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return _(this,null,function*(){let e=[];for(let[s,W]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",s);let X=yield this.convertFileToBase64(W);e.push({fileName:s,fileData:X})}let o=this.formDataService.getDatosIniciales(),n=b(E({},this.datoscomercialtvs.value),{totales:{marketshare_total:this.totalMarketshare,unidades_vendidas_total:this.totalUnidadesVendidas},fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",n),this.formService.upload(e,o,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,n).subscribe({next:s=>{console.log("\u2705 Datos enviados exitosamente:",s),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:s=>{console.error("\u274C Error al enviar:",s),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(o){return new(o||r)(g(H),g(Q),g(K),g(G))}}static{this.\u0275cmp=T({type:r,selectors:[["app-comercial-tvs"]],standalone:!0,features:[F,I],decls:82,vars:9,consts:[[1,"form-header"],[1,"header-content"],[1,"header-text"],["src","assets/auteco-logo.png","alt","Logo Empresa",1,"logo-empresa"],["id","msform"],[1,"border-tvs",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","tvs-table"],[1,"acciones-col"],["formArrayName","participacion_mercado"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],[1,"total-label"],[1,"total-cell"],[1,"resultado-total-final"],["type","button",1,"btn-agregar-fila",3,"click"],[1,"subsection-header",2,"margin-top","50px"],[1,"gri-table","tvs-table-ventas"],["formArrayName","ventas_modelo"],["colspan","2",1,"total-label"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","marca","placeholder","Nombre de la marca",3,"ngClass"],["class","error-text",4,"ngIf"],["type","number","formControlName","marketshare","step","0.01","placeholder","0.00",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"],["type","text","formControlName","segmento","placeholder","Ej: Sport, Scooter, etc.",3,"ngClass"],["type","text","formControlName","modelo","placeholder","Nombre del modelo",3,"ngClass"],["type","number","formControlName","unidades_vendidas","placeholder","0",3,"ngClass"]],template:function(o,n){o&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),u(4,"img",3),a(5," Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),t(),i(6,"p"),a(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),t()()()(),i(8,"form",4)(9,"fieldset",5)(10,"form",6),f("ngSubmit",function(){return n.submitFormComercialTvs()}),i(11,"div",7)(12,"span",8),a(13,"\u{1F3CD}\uFE0F"),t(),i(14,"h2"),a(15,"Participaci\xF3n en el Mercado de Combusti\xF3n"),t()(),i(16,"p",9),a(17," Complete la informaci\xF3n sobre participaci\xF3n en el mercado de motocicletas de combusti\xF3n y ventas por modelo "),t(),i(18,"div",10)(19,"strong"),a(20,"\u2139\uFE0F INSTRUCCIONES:"),t(),a(21," Agregue filas seg\xFAn sea necesario. Los totales se calcular\xE1n autom\xE1ticamente. "),t(),i(22,"div",11)(23,"span",8),a(24,"\u{1F4CA}"),t(),a(25," PARTICIPACI\xD3N EN EL MERCADO DE COMBUSTI\xD3N - Contenido GRI: N/A "),t(),i(26,"h3",12),a(27,"Participaci\xF3n en el mercado de combusti\xF3n"),t(),i(28,"div",13)(29,"table",14)(30,"thead")(31,"tr")(32,"th"),a(33,"Marca"),t(),i(34,"th"),a(35,"Marketshare (%)"),t(),i(36,"th",15),a(37,"Acciones"),t()()(),i(38,"tbody",16),p(39,ie,9,6,"tr",17),i(40,"tr",18)(41,"td",19)(42,"strong"),a(43,"Total"),t()(),i(44,"td",20)(45,"span",21),a(46),N(47,"number"),t()(),u(48,"td"),t()()()(),i(49,"button",22),f("click",function(){return n.agregarFilaParticipacion()}),a(50," \u2795 Agregar marca "),t(),i(51,"div",23)(52,"span",8),a(53,"\u{1F3C1}"),t(),a(54," VENTAS POR MODELO Y SEGMENTO - Contenido GRI: N/A "),t(),i(55,"h3",12),a(56,"Ventas por modelo y segmento de motocicletas"),t(),i(57,"div",13)(58,"table",24)(59,"thead")(60,"tr")(61,"th"),a(62,"Segmento"),t(),i(63,"th"),a(64,"Modelo"),t(),i(65,"th"),a(66,"Unidades vendidas"),t(),i(67,"th",15),a(68,"Acciones"),t()()(),i(69,"tbody",25),p(70,le,12,8,"tr",17),i(71,"tr",18)(72,"td",26)(73,"strong"),a(74,"Total"),t()(),i(75,"td",20)(76,"span",21),a(77),t()(),u(78,"td"),t()()()(),i(79,"button",22),f("click",function(){return n.agregarFilaVentas()}),a(80," \u2795 Agregar modelo "),t(),i(81,"input",27),f("click",function(){return n.submitFormComercialTvs()}),t()()()()),o&2&&(l(9),m("hidden",!n.comercialTvs),l(),m("formGroup",n.datoscomercialtvs),l(29),m("ngForOf",n.participacionMercado.controls),l(7),h("",M(47,6,n.totalMarketshare,"1.2-2"),"%"),l(24),m("ngForOf",n.ventasModelo.controls),l(7),y(n.totalUnidadesVendidas))},dependencies:[w,D,k,A,V,z,U,P,$,R,B,L,Y,j,q]})}}return r})();export{ge as ComercialTvsComponent};
