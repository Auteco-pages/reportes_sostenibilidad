import{a as J}from"./chunk-2PSR7T7J.js";import{a as V,b as c,c as M,d as L,e as R,f as q,g as G,i as k,j as P,k as O,l as B,q as U,r as $,s as Y,t as H}from"./chunk-6S4UDF73.js";import{B as r,C as g,F as T,G as p,I as s,K as t,L as e,M as S,P as v,Q as f,R as m,S as i,T as h,U as _,W as I,a as C,b as F,c as x,da as A,ea as N,fa as D,ha as j,na as w,s as y,w as E,x as b}from"./chunk-ACHKL7EZ.js";function Q(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m().$implicit,l=m();r(),_(" ",l.getErrorMessage(n,"mecanismo_formacion")," ")}}function W(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m().$implicit,l=m();r(),_(" ",l.getErrorMessage(n,"valor")," ")}}function X(o,u){if(o&1){let n=v();t(0,"button",44),f("click",function(){E(n);let a=m().index,d=m();return b(d.eliminarFilaFormacionSST(a))}),i(1," \u274C "),e()}}function Z(o,u){if(o&1&&(t(0,"tr",38)(1,"td"),S(2,"input",39),p(3,Q,2,1,"span",29),e(),t(4,"td"),S(5,"input",40),p(6,W,2,1,"span",29),e(),t(7,"td",41),p(8,X,2,0,"button",42),e()()),o&2){let n=u.$implicit,l=u.index,a=m();s("formGroupName",l),r(2),s("ngClass",a.getFieldClass(n,"mecanismo_formacion")),r(),s("ngIf",a.shouldShowError(n,"mecanismo_formacion")),r(2),s("ngClass",a.getFieldClass(n,"valor")),r(),s("ngIf",a.shouldShowError(n,"valor")),r(2),s("ngIf",a.formacionSST.length>1)}}function ee(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m().$implicit,l=m();r(),_(" ",l.getErrorMessage(n,"actividad_promocion")," ")}}function te(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m().$implicit,l=m();r(),_(" ",l.getErrorMessage(n,"valor")," ")}}function ie(o,u){if(o&1){let n=v();t(0,"button",44),f("click",function(){E(n);let a=m().index,d=m();return b(d.eliminarFilaPromocionSalud(a))}),i(1," \u274C "),e()}}function ne(o,u){if(o&1&&(t(0,"tr",38)(1,"td"),S(2,"input",45),p(3,ee,2,1,"span",29),e(),t(4,"td"),S(5,"input",40),p(6,te,2,1,"span",29),e(),t(7,"td",41),p(8,ie,2,0,"button",42),e()()),o&2){let n=u.$implicit,l=u.index,a=m();s("formGroupName",l),r(2),s("ngClass",a.getFieldClass(n,"actividad_promocion")),r(),s("ngIf",a.shouldShowError(n,"actividad_promocion")),r(2),s("ngClass",a.getFieldClass(n,"valor")),r(),s("ngIf",a.shouldShowError(n,"valor")),r(2),s("ngIf",a.promocionSalud.length>1)}}function ae(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"tasa_accidentalidad")," ")}}function oe(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"accidentes_mujeres")," ")}}function re(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"accidentes_hombres")," ")}}function le(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"lesiones_mujeres")," ")}}function se(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"lesiones_hombres")," ")}}function me(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"fallecimientos_mujeres")," ")}}function de(o,u){if(o&1&&(t(0,"span",43),i(1),e()),o&2){let n=m();r(),_(" ",n.getErrorMessage(n.datossst,"fallecimientos_hombres")," ")}}var Ee=(()=>{class o extends Y{constructor(n,l,a,d){super(),this.formBuilder=n,this.formService=l,this.formDataService=a,this.router=d,this.sst=!0,this.datossst=new R({}),this.filesToUpload=new Map,this.totalFormacionSST=0,this.totalPromocionSalud=0,this.totalAccidentesLaborales=0,this.totalLesionesMayores=0,this.totalFallecimientos=0}ngOnInit(){this.datossst=this.formBuilder.group({formacion_sst:this.formBuilder.array([]),promocion_salud:this.formBuilder.array([]),tasa_accidentalidad:["",[c.required,c.min(0)]],accidentes_mujeres:["",[c.required,c.min(0)]],accidentes_hombres:["",[c.required,c.min(0)]],lesiones_mujeres:["",[c.required,c.min(0)]],lesiones_hombres:["",[c.required,c.min(0)]],fallecimientos_mujeres:["",[c.required,c.min(0)]],fallecimientos_hombres:["",[c.required,c.min(0)]]}),this.agregarFilaFormacionSST(),this.agregarFilaPromocionSalud(),this.datossst.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get formacionSST(){return this.datossst.get("formacion_sst")}agregarFilaFormacionSST(){let n=this.formBuilder.group({mecanismo_formacion:["",c.required],valor:["",[c.required,c.min(0)]]});n.valueChanges.subscribe(()=>this.calcularTotales()),this.formacionSST.push(n)}eliminarFilaFormacionSST(n){this.formacionSST.removeAt(n),this.calcularTotales()}get promocionSalud(){return this.datossst.get("promocion_salud")}agregarFilaPromocionSalud(){let n=this.formBuilder.group({actividad_promocion:["",c.required],valor:["",[c.required,c.min(0)]]});n.valueChanges.subscribe(()=>this.calcularTotales()),this.promocionSalud.push(n)}eliminarFilaPromocionSalud(n){this.promocionSalud.removeAt(n),this.calcularTotales()}calcularTotales(){this.totalFormacionSST=this.formacionSST.controls.reduce((n,l)=>n+(Number(l.get("valor")?.value)||0),0),this.totalPromocionSalud=this.promocionSalud.controls.reduce((n,l)=>n+(Number(l.get("valor")?.value)||0),0),this.totalAccidentesLaborales=this.getNumericValue("accidentes_mujeres")+this.getNumericValue("accidentes_hombres"),this.totalLesionesMayores=this.getNumericValue("lesiones_mujeres")+this.getNumericValue("lesiones_hombres"),this.totalFallecimientos=this.getNumericValue("fallecimientos_mujeres")+this.getNumericValue("fallecimientos_hombres")}getNumericValue(n){return Number(this.datossst.get(n)?.value)||0}onFileSelected(n,l){let a=n.target.files[0];a&&(this.filesToUpload.set(l,a),console.log(`Archivo seleccionado: ${a.name} para ${l}`))}convertFileToBase64(n){return x(this,null,function*(){return new Promise((l,a)=>{let d=new FileReader;d.onload=()=>l(d.result),d.onerror=a,d.readAsDataURL(n)})})}submitFormSST(){return x(this,null,function*(){this.markFormGroupTouched(this.datossst),this.datossst.valid?(console.log("\u2705 Formulario SST v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario SST inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return x(this,null,function*(){let n=[];for(let[d,z]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",d);let K=yield this.convertFileToBase64(z);n.push({fileName:d,fileData:K})}let l=this.formDataService.getDatosIniciales(),a=F(C({},this.datossst.value),{totales:{formacion_sst:this.totalFormacionSST,promocion_salud:this.totalPromocionSalud,accidentes_laborales:this.totalAccidentesLaborales,lesiones_mayores:this.totalLesionesMayores,fallecimientos:this.totalFallecimientos},fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",a),this.formService.upload(n,l,null,null,null,null,null,null,null,null,null,a).subscribe({next:d=>{console.log("\u2705 Datos enviados exitosamente:",d),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:d=>{console.error("\u274C Error al enviar:",d),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(l){return new(l||o)(g(U),g(J),g(H),g(w))}}static{this.\u0275cmp=y({type:o,selectors:[["app-sst"]],standalone:!0,features:[T,I],decls:209,vars:23,consts:[[1,"form-header"],[1,"header-content"],["src","assets/logo.png","alt","Logo Empresa",1,"logo-empresa"],[1,"header-text"],["id","progressbar"],["id","msform"],[1,"border-purple",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","sst-table"],[1,"acciones-col"],["formArrayName","formacion_sst"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],[1,"total-label"],[1,"total-cell"],[1,"resultado-total"],["type","button",1,"btn-agregar-fila",3,"click"],[1,"subsection-header",2,"margin-top","50px"],["formArrayName","promocion_salud"],[1,"gri-table","sst-table-simple"],[1,"dato-label"],["type","number","formControlName","tasa_accidentalidad","step","0.01","placeholder","0.00",3,"ngClass"],["class","error-text",4,"ngIf"],[1,"table-subtitle",2,"margin-top","40px"],["type","number","formControlName","accidentes_mujeres","placeholder","0",3,"ngClass"],["type","number","formControlName","accidentes_hombres","placeholder","0",3,"ngClass"],["type","number","formControlName","lesiones_mujeres","placeholder","0",3,"ngClass"],["type","number","formControlName","lesiones_hombres","placeholder","0",3,"ngClass"],["type","number","formControlName","fallecimientos_mujeres","placeholder","0",3,"ngClass"],["type","number","formControlName","fallecimientos_hombres","placeholder","0",3,"ngClass"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","mecanismo_formacion","placeholder","Ej: Capacitaci\xF3n presencial, e-learning, etc.",3,"ngClass"],["type","number","formControlName","valor","placeholder","0",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"],["type","text","formControlName","actividad_promocion","placeholder","Ej: Jornadas de vacunaci\xF3n, programas de bienestar, etc.",3,"ngClass"]],template:function(l,a){l&1&&(t(0,"div",0)(1,"div",1),S(2,"img",2),t(3,"div",3)(4,"h1"),i(5,"Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),e(),t(6,"p"),i(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),e()()()(),S(8,"div",4),t(9,"form",5)(10,"fieldset",6)(11,"form",7),f("ngSubmit",function(){return a.submitFormSST()}),t(12,"div",8)(13,"span",9),i(14,"\u{1F3E5}"),e(),t(15,"h2"),i(16,"Seguridad y Salud en el Trabajo (SST)"),e()(),t(17,"p",10),i(18," Complete la informaci\xF3n sobre formaci\xF3n en SST, promoci\xF3n de la salud y accidentalidad laboral "),e(),t(19,"div",11)(20,"strong"),i(21,"\u2139\uFE0F INSTRUCCIONES:"),e(),i(22," Agregue filas seg\xFAn sea necesario para cada actividad. Los totales se calcular\xE1n autom\xE1ticamente. "),e(),t(23,"div",12)(24,"span",9),i(25,"\u{1F4DA}"),e(),i(26," FORMACI\xD3N DE COLABORADORES EN SST - Contenido GRI: 403-5 "),e(),t(27,"h3",13),i(28,"Formaci\xF3n de trabajadores sobre salud y seguridad en el trabajo"),e(),t(29,"div",14)(30,"table",15)(31,"thead")(32,"tr")(33,"th"),i(34,"Mecanismo de formaci\xF3n"),e(),t(35,"th"),i(36,"Valor"),e(),t(37,"th",16),i(38,"Acciones"),e()()(),t(39,"tbody",17),p(40,Z,9,6,"tr",18),t(41,"tr",19)(42,"td",20)(43,"strong"),i(44,"Total"),e()(),t(45,"td",21)(46,"span",22),i(47),e()(),S(48,"td"),e()()()(),t(49,"button",23),f("click",function(){return a.agregarFilaFormacionSST()}),i(50," \u2795 Agregar mecanismo de formaci\xF3n "),e(),t(51,"div",24)(52,"span",9),i(53,"\u{1F4AA}"),e(),i(54," ACTIVIDADES DE PROMOCI\xD3N A LA SALUD - Contenido GRI: 403-6 "),e(),t(55,"h3",13),i(56,"Programas de promoci\xF3n de la salud de colaboradores"),e(),t(57,"div",14)(58,"table",15)(59,"thead")(60,"tr")(61,"th"),i(62,"Actividades de promoci\xF3n de la salud"),e(),t(63,"th"),i(64,"Valor"),e(),t(65,"th",16),i(66,"Acciones"),e()()(),t(67,"tbody",25),p(68,ne,9,6,"tr",18),t(69,"tr",19)(70,"td",20)(71,"strong"),i(72,"Total"),e()(),t(73,"td",21)(74,"span",22),i(75),e()(),S(76,"td"),e()()()(),t(77,"button",23),f("click",function(){return a.agregarFilaPromocionSalud()}),i(78," \u2795 Agregar actividad de promoci\xF3n "),e(),t(79,"div",24)(80,"span",9),i(81,"\u26A0\uFE0F"),e(),i(82," ACCIDENTES Y FATALIDADES LABORALES - Contenido GRI: 403-9, 403-10 "),e(),t(83,"h3",13),i(84,"Tasa de accidentalidad laboral"),e(),t(85,"div",14)(86,"table",26)(87,"thead")(88,"tr")(89,"th"),i(90,"Actividades de promoci\xF3n de la salud"),e(),t(91,"th"),i(92,"Valor"),e()()(),t(93,"tbody")(94,"tr")(95,"td",27),i(96,"Tasa de accidentalidad laboral (%)"),e(),t(97,"td"),S(98,"input",28),p(99,ae,2,1,"span",29),e()()()()(),t(100,"h3",30),i(101,"Accidentalidad laboral"),e(),t(102,"div",14)(103,"table",26)(104,"thead")(105,"tr")(106,"th"),i(107,"Actividades de promoci\xF3n de la salud"),e(),t(108,"th"),i(109,"Valor"),e()()(),t(110,"tbody")(111,"tr")(112,"td",27),i(113,"N\xFAmero de colaboradoras "),t(114,"strong"),i(115,"mujeres"),e(),i(116," que sufrieron un accidente laboral"),e(),t(117,"td"),S(118,"input",31),p(119,oe,2,1,"span",29),e()(),t(120,"tr")(121,"td",27),i(122,"N\xFAmero de colaboradoras "),t(123,"strong"),i(124,"hombres"),e(),i(125," que sufrieron un accidente laboral"),e(),t(126,"td"),S(127,"input",32),p(128,re,2,1,"span",29),e()(),t(129,"tr",19)(130,"td",20)(131,"strong"),i(132,"Total"),e()(),t(133,"td",21)(134,"span",22),i(135),e()()()()()(),t(136,"h3",30),i(137,"Lesiones mayores"),e(),t(138,"div",14)(139,"table",26)(140,"thead")(141,"tr")(142,"th"),i(143,"Actividades de promoci\xF3n de la salud"),e(),t(144,"th"),i(145,"Valor"),e()()(),t(146,"tbody")(147,"tr")(148,"td",27),i(149,"N\xFAmero de colaboradoras "),t(150,"strong"),i(151,"mujeres"),e(),i(152," que sufrieron un accidente laboral y provoc\xF3 una discapacidad"),e(),t(153,"td"),S(154,"input",33),p(155,le,2,1,"span",29),e()(),t(156,"tr")(157,"td",27),i(158,"N\xFAmero de colaboradoras "),t(159,"strong"),i(160,"hombres"),e(),i(161," que sufrieron un accidente laboral y provoc\xF3 una discapacidad"),e(),t(162,"td"),S(163,"input",34),p(164,se,2,1,"span",29),e()(),t(165,"tr",19)(166,"td",20)(167,"strong"),i(168,"Total"),e()(),t(169,"td",21)(170,"span",22),i(171),e()()()()()(),t(172,"h3",30),i(173,"Fallecimientos"),e(),t(174,"div",14)(175,"table",26)(176,"thead")(177,"tr")(178,"th"),i(179,"Actividades de promoci\xF3n de la salud"),e(),t(180,"th"),i(181,"Valor"),e()()(),t(182,"tbody")(183,"tr")(184,"td",27),i(185,"N\xFAmero de colaboradoras "),t(186,"strong"),i(187,"mujeres"),e(),i(188," que sufrieron un accidente laboral y desencaden\xF3 un fallecimiento."),e(),t(189,"td"),S(190,"input",35),p(191,me,2,1,"span",29),e()(),t(192,"tr")(193,"td",27),i(194,"N\xFAmero de colaboradoras "),t(195,"strong"),i(196,"hombres"),e(),i(197," que sufrieron un accidente laboral y desencaden\xF3 un fallecimiento."),e(),t(198,"td"),S(199,"input",36),p(200,de,2,1,"span",29),e()(),t(201,"tr",19)(202,"td",20)(203,"strong"),i(204,"Total"),e()(),t(205,"td",21)(206,"span",22),i(207),e()()()()()(),t(208,"input",37),f("click",function(){return a.submitFormSST()}),e()()()()),l&2&&(r(10),s("hidden",!a.sst),r(),s("formGroup",a.datossst),r(29),s("ngForOf",a.formacionSST.controls),r(7),h(a.totalFormacionSST),r(21),s("ngForOf",a.promocionSalud.controls),r(7),h(a.totalPromocionSalud),r(23),s("ngClass",a.getFieldClass(a.datossst,"tasa_accidentalidad")),r(),s("ngIf",a.shouldShowError(a.datossst,"tasa_accidentalidad")),r(19),s("ngClass",a.getFieldClass(a.datossst,"accidentes_mujeres")),r(),s("ngIf",a.shouldShowError(a.datossst,"accidentes_mujeres")),r(8),s("ngClass",a.getFieldClass(a.datossst,"accidentes_hombres")),r(),s("ngIf",a.shouldShowError(a.datossst,"accidentes_hombres")),r(7),h(a.totalAccidentesLaborales),r(19),s("ngClass",a.getFieldClass(a.datossst,"lesiones_mujeres")),r(),s("ngIf",a.shouldShowError(a.datossst,"lesiones_mujeres")),r(8),s("ngClass",a.getFieldClass(a.datossst,"lesiones_hombres")),r(),s("ngIf",a.shouldShowError(a.datossst,"lesiones_hombres")),r(7),h(a.totalLesionesMayores),r(19),s("ngClass",a.getFieldClass(a.datossst,"fallecimientos_mujeres")),r(),s("ngIf",a.shouldShowError(a.datossst,"fallecimientos_mujeres")),r(8),s("ngClass",a.getFieldClass(a.datossst,"fallecimientos_hombres")),r(),s("ngIf",a.shouldShowError(a.datossst,"fallecimientos_hombres")),r(7),h(a.totalFallecimientos))},dependencies:[j,A,N,D,$,q,V,G,M,L,k,B,P,O]})}}return o})();export{Ee as SstComponent};
