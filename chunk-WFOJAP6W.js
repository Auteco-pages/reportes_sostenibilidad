import{a as Y}from"./chunk-2PSR7T7J.js";import{a as V,b as s,c as k,d as w,e as R,f as q,g as j,i as O,j as P,k as M,l as W,q as $,r as z,s as J,t as H}from"./chunk-6S4UDF73.js";import{B as o,C,F as G,G as _,I as r,K as t,L as e,M as u,P as F,Q as g,R as p,S as i,T as b,U as y,W as N,Y as f,Z as h,c as S,da as A,ea as T,fa as B,ga as U,ha as I,na as L,s as D,w as v,x}from"./chunk-ACHKL7EZ.js";function Q(m,d){if(m&1){let a=F();t(0,"button",46),g("click",function(){v(a);let n=p().index,c=p();return x(c.eliminarFilaConsumoGrupo(n))}),i(1," \u274C "),e()}}function X(m,d){if(m&1&&(t(0,"tr",39)(1,"td"),u(2,"input",40),e(),t(3,"td"),u(4,"input",41),e(),t(5,"td"),u(6,"input",42),e(),t(7,"td"),u(8,"input",43),e(),t(9,"td",44),_(10,Q,2,0,"button",45),e()()),m&2){let a=d.$implicit,l=d.index,n=p();r("formGroupName",l),o(2),r("ngClass",n.getFieldClass(a,"tipo_fuente")),o(2),r("ngClass",n.getFieldClass(a,"tipo_energia")),o(2),r("ngClass",n.getFieldClass(a,"energia_consumida")),o(2),r("ngClass",n.getFieldClass(a,"consumo_energia")),o(2),r("ngIf",n.consumoEnergiaGrupo.length>1)}}function Z(m,d){if(m&1){let a=F();t(0,"button",46),g("click",function(){v(a);let n=p().index,c=p();return x(c.eliminarFilaConsumoBLUE(n))}),i(1," \u274C "),e()}}function ee(m,d){if(m&1&&(t(0,"tr",39)(1,"td"),u(2,"input",40),e(),t(3,"td"),u(4,"input",41),e(),t(5,"td"),u(6,"input",42),e(),t(7,"td"),u(8,"input",43),e(),t(9,"td",44),_(10,Z,2,0,"button",45),e()()),m&2){let a=d.$implicit,l=d.index,n=p();r("formGroupName",l),o(2),r("ngClass",n.getFieldClass(a,"tipo_fuente")),o(2),r("ngClass",n.getFieldClass(a,"tipo_energia")),o(2),r("ngClass",n.getFieldClass(a,"energia_consumida")),o(2),r("ngClass",n.getFieldClass(a,"consumo_energia")),o(2),r("ngIf",n.consumoEnergiaBLUE.length>1)}}function te(m,d){if(m&1){let a=F();t(0,"button",46),g("click",function(){v(a);let n=p().index,c=p();return x(c.eliminarFilaEficiencia(n))}),i(1," \u274C "),e()}}function ie(m,d){if(m&1&&(t(0,"tr",39)(1,"td"),u(2,"input",47),e(),t(3,"td"),u(4,"textarea",48),e(),t(5,"td"),u(6,"textarea",49),e(),t(7,"td"),u(8,"input",50),e(),t(9,"td",44),_(10,te,2,0,"button",45),e()()),m&2){let a=d.$implicit,l=d.index,n=p();r("formGroupName",l),o(2),r("ngClass",n.getFieldClass(a,"accion_implementada")),o(2),r("ngClass",n.getFieldClass(a,"descripcion_acciones")),o(2),r("ngClass",n.getFieldClass(a,"descripcion_resultados")),o(2),r("ngClass",n.getFieldClass(a,"ahorros_energia")),o(2),r("ngIf",n.accionesEficiencia.length>1)}}var de=(()=>{class m extends J{constructor(a,l,n,c){super(),this.formBuilder=a,this.formService=l,this.formDataService=n,this.router=c,this.eficienciaEnergetica=!0,this.datoseficienciaenergetica=new R({}),this.filesToUpload=new Map,this.totalConsumoEnergiaGrupo=0,this.consumoTotalGrupo=0,this.unidadesProducidasGrupo=0,this.consumoPorUnidadGrupo=0,this.porcentajeVariacionGrupo=0,this.totalConsumoEnergiaBLUE=0,this.porcentajeVariacionBLUE=0,this.totalAhorrosEnergia=0}ngOnInit(){this.datoseficienciaenergetica=this.formBuilder.group({consumo_energia_grupo:this.formBuilder.array([]),consumo_total_energia:["",[s.required,s.min(0)]],unidades_producidas:["",[s.required,s.min(0)]],consumo_actual_grupo:["",[s.required,s.min(0)]],consumo_anterior_grupo:["",[s.required,s.min(0)]],consumo_energia_blue:this.formBuilder.array([]),consumo_actual_blue:["",[s.required,s.min(0)]],consumo_anterior_blue:["",[s.required,s.min(0)]],acciones_eficiencia:this.formBuilder.array([])}),this.agregarFilaConsumoGrupo(),this.agregarFilaConsumoBLUE(),this.agregarFilaEficiencia(),this.datoseficienciaenergetica.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get consumoEnergiaGrupo(){return this.datoseficienciaenergetica.get("consumo_energia_grupo")}agregarFilaConsumoGrupo(){let a=this.formBuilder.group({tipo_fuente:["",s.required],tipo_energia:["",s.required],energia_consumida:["",s.required],consumo_energia:["",[s.required,s.min(0)]]});a.valueChanges.subscribe(()=>this.calcularTotales()),this.consumoEnergiaGrupo.push(a)}eliminarFilaConsumoGrupo(a){this.consumoEnergiaGrupo.length>1&&(this.consumoEnergiaGrupo.removeAt(a),this.calcularTotales())}get consumoEnergiaBLUE(){return this.datoseficienciaenergetica.get("consumo_energia_blue")}agregarFilaConsumoBLUE(){let a=this.formBuilder.group({tipo_fuente:["",s.required],tipo_energia:["",s.required],energia_consumida:["",s.required],consumo_energia:["",[s.required,s.min(0)]]});a.valueChanges.subscribe(()=>this.calcularTotales()),this.consumoEnergiaBLUE.push(a)}eliminarFilaConsumoBLUE(a){this.consumoEnergiaBLUE.length>1&&(this.consumoEnergiaBLUE.removeAt(a),this.calcularTotales())}get accionesEficiencia(){return this.datoseficienciaenergetica.get("acciones_eficiencia")}agregarFilaEficiencia(){let a=this.formBuilder.group({accion_implementada:["",s.required],descripcion_acciones:["",s.required],descripcion_resultados:["",s.required],ahorros_energia:["",[s.required,s.min(0)]]});a.valueChanges.subscribe(()=>this.calcularTotales()),this.accionesEficiencia.push(a)}eliminarFilaEficiencia(a){this.accionesEficiencia.length>1&&(this.accionesEficiencia.removeAt(a),this.calcularTotales())}calcularTotales(){this.totalConsumoEnergiaGrupo=0,this.consumoEnergiaGrupo.controls.forEach(E=>{this.totalConsumoEnergiaGrupo+=Number(E.get("consumo_energia")?.value)||0}),this.consumoTotalGrupo=this.getNumericValue("consumo_total_energia"),this.unidadesProducidasGrupo=this.getNumericValue("unidades_producidas"),this.consumoPorUnidadGrupo=this.unidadesProducidasGrupo>0?this.consumoTotalGrupo/this.unidadesProducidasGrupo:0;let a=this.getNumericValue("consumo_actual_grupo"),l=this.getNumericValue("consumo_anterior_grupo");l>0?this.porcentajeVariacionGrupo=(a-l)/l*100:this.porcentajeVariacionGrupo=0,this.totalConsumoEnergiaBLUE=0,this.consumoEnergiaBLUE.controls.forEach(E=>{this.totalConsumoEnergiaBLUE+=Number(E.get("consumo_energia")?.value)||0});let n=this.getNumericValue("consumo_actual_blue"),c=this.getNumericValue("consumo_anterior_blue");c>0?this.porcentajeVariacionBLUE=(n-c)/c*100:this.porcentajeVariacionBLUE=0,this.totalAhorrosEnergia=0,this.accionesEficiencia.controls.forEach(E=>{this.totalAhorrosEnergia+=Number(E.get("ahorros_energia")?.value)||0})}getNumericValue(a){let l=this.datoseficienciaenergetica.get(a)?.value;return Number(l)||0}onFileSelected(a,l){let n=a.target.files[0];n&&(this.filesToUpload.set(l,n),console.log(`Archivo seleccionado: ${n.name} para ${l}`))}convertFileToBase64(a){return S(this,null,function*(){return new Promise((l,n)=>{let c=new FileReader;c.onload=()=>l(c.result),c.onerror=n,c.readAsDataURL(a)})})}submitFormEficienciaEnergetica(){return S(this,null,function*(){this.markFormGroupTouched(this.datoseficienciaenergetica),this.datoseficienciaenergetica.valid?(console.log("\u2705 Formulario Eficiencia Energ\xE9tica v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Eficiencia Energ\xE9tica inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return S(this,null,function*(){let a=[];for(let[c,E]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",c);let K=yield this.convertFileToBase64(E);a.push({fileName:c,fileData:K})}let l=this.formDataService.getDatosIniciales(),n={consumo_energia_grupo_auteco:{datos:this.datoseficienciaenergetica.value.consumo_energia_grupo,totales:{total_consumo_energia:this.totalConsumoEnergiaGrupo}},intensidad_energetica:{consumo_total:this.consumoTotalGrupo,unidades_producidas:this.unidadesProducidasGrupo,consumo_por_unidad:this.consumoPorUnidadGrupo},reduccion_consumo_grupo:{consumo_actual:this.getNumericValue("consumo_actual_grupo"),consumo_anterior:this.getNumericValue("consumo_anterior_grupo"),porcentaje_variacion:this.porcentajeVariacionGrupo},consumo_energia_blue:{datos:this.datoseficienciaenergetica.value.consumo_energia_blue,totales:{total_consumo_energia:this.totalConsumoEnergiaBLUE}},reduccion_consumo_blue:{consumo_actual:this.getNumericValue("consumo_actual_blue"),consumo_anterior:this.getNumericValue("consumo_anterior_blue"),porcentaje_variacion:this.porcentajeVariacionBLUE},eficiencia_energetica:{datos:this.datoseficienciaenergetica.value.acciones_eficiencia,totales:{total_ahorros_energia:this.totalAhorrosEnergia}},metadata:{fecha_reporte:new Date().toISOString(),formulario_completo:this.datoseficienciaenergetica.valid}};console.log("\u{1F4CA} Datos a enviar:",n),this.formService.upload(a,l,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,n).subscribe({next:c=>{console.log("\u2705 Datos enviados exitosamente:",c),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:c=>{console.error("\u274C Error al enviar:",c),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(l){return new(l||m)(C($),C(Y),C(H),C(L))}}static{this.\u0275cmp=D({type:m,selectors:[["app-eficiencia-energetica"]],standalone:!0,features:[G,N],decls:203,vars:35,consts:[[1,"form-header"],[1,"header-content"],["src","assets/logo.png","alt","Logo Empresa",1,"logo-empresa"],[1,"header-text"],["id","msform"],[1,"border-green",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","energia-table-grande"],[1,"acciones-col"],["formArrayName","consumo_energia_grupo"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],["colspan","3",1,"total-label"],[1,"total-cell"],[1,"resultado-total-final"],["type","button",1,"btn-agregar-fila",3,"click"],[1,"subsection-header",2,"margin-top","50px"],[1,"gri-table","energia-table-intensidad"],["type","number","formControlName","consumo_total_energia","step","0.01","placeholder","0",3,"ngClass"],["type","number","formControlName","unidades_producidas","placeholder","0",3,"ngClass"],[1,"valor-calculado"],[1,"dato-label",2,"text-align","center"],[1,"gri-table","energia-table-reduccion"],["type","number","formControlName","consumo_actual_grupo","step","0.01","placeholder","0",3,"ngClass"],["type","number","formControlName","consumo_anterior_grupo","step","0.01","placeholder","0",3,"ngClass"],["formArrayName","consumo_energia_blue"],[1,"table-subtitle",2,"margin-top","50px"],["type","number","formControlName","consumo_actual_blue","step","0.01","placeholder","0",3,"ngClass"],["type","number","formControlName","consumo_anterior_blue","step","0.01","placeholder","0",3,"ngClass"],[1,"gri-table","energia-table-acciones"],["formArrayName","acciones_eficiencia"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","tipo_fuente","placeholder","Tipo de fuente",3,"ngClass"],["type","text","formControlName","tipo_energia","placeholder","Tipo de energ\xEDa",3,"ngClass"],["type","text","formControlName","energia_consumida","placeholder","Energ\xEDa consumida",3,"ngClass"],["type","number","formControlName","consumo_energia","step","0.01","placeholder","0.00",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"],["type","text","formControlName","accion_implementada","placeholder","Acci\xF3n implementada",3,"ngClass"],["formControlName","descripcion_acciones","placeholder","Descripci\xF3n de las acciones...","rows","3",3,"ngClass"],["formControlName","descripcion_resultados","placeholder","Descripci\xF3n de los resultados...","rows","3",3,"ngClass"],["type","number","formControlName","ahorros_energia","step","0.01","placeholder","0.00",3,"ngClass"]],template:function(l,n){l&1&&(t(0,"div",0)(1,"div",1),u(2,"img",2),t(3,"div",3)(4,"h1"),i(5,"Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),e(),t(6,"p"),i(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),e()()()(),t(8,"form",4)(9,"fieldset",5)(10,"form",6),g("ngSubmit",function(){return n.submitFormEficienciaEnergetica()}),t(11,"div",7)(12,"span",8),i(13,"\u{1F4A1}"),e(),t(14,"h2"),i(15,"Eficiencia en el Uso del Agua"),e()(),t(16,"p",9),i(17," Complete la informaci\xF3n sobre consumo de energ\xEDa, intensidad energ\xE9tica y acciones de eficiencia "),e(),t(18,"div",10)(19,"strong"),i(20,"\u2139\uFE0F INSTRUCCIONES:"),e(),i(21," Complete todas las secciones sobre consumo energ\xE9tico del Grupo Auteco y Auteco BLUE. "),e(),t(22,"div",11)(23,"span",8),i(24,"\u26A1"),e(),i(25," EFICIENCIA EN EL USO DEL AGUA - Contenido GRI: 302-1 "),e(),t(26,"h3",12),i(27,"Consumo de energ\xEDa dentro de la organizaci\xF3n (Grupo Auteco)"),e(),t(28,"div",13)(29,"table",14)(30,"thead")(31,"tr")(32,"th"),i(33,"Tipo de fuente"),e(),t(34,"th"),i(35,"Tipo de energ\xEDa consumida"),e(),t(36,"th"),i(37,"Eneg\xEDa consumida"),e(),t(38,"th"),i(39,"Consumo de energ\xEDa (GJ)"),e(),t(40,"th",15),i(41,"Acciones"),e()()(),t(42,"tbody",16),_(43,X,11,6,"tr",17),t(44,"tr",18)(45,"td",19)(46,"strong"),i(47,"TOTAL"),e()(),t(48,"td",20)(49,"span",21),i(50),f(51,"number"),e()(),u(52,"td"),e()()()(),t(53,"button",22),g("click",function(){return n.agregarFilaConsumoGrupo()}),i(54," \u2795 Agregar fuente de energ\xEDa "),e(),t(55,"div",23)(56,"span",8),i(57,"\u{1F4CA}"),e(),i(58," INTENSIDAD ENERG\xC9TICA - Contenido GRI: 302-3 "),e(),t(59,"h3",12),i(60,"Intensidad del consumo de energ\xEDa el\xE9ctrica (Grupo Auteco)"),e(),t(61,"div",13)(62,"table",24)(63,"thead")(64,"tr")(65,"th"),i(66,"Consumo total de energ\xEDa el\xE9ctrica a\xF1o actual (kWh)"),e(),t(67,"th"),i(68,"Unidades producidas"),e(),t(69,"th"),i(70,"Consumo de electricidad por unidades producidas"),e()()(),t(71,"tbody")(72,"tr")(73,"td"),u(74,"input",25),e(),t(75,"td"),u(76,"input",26),e(),t(77,"td",27)(78,"span",21),i(79),f(80,"number"),e()()(),t(81,"tr")(82,"td",28),i(83,"0"),e(),t(84,"td",28),i(85,"0"),e(),t(86,"td",28),i(87,"0.00"),e()()()()(),t(88,"div",23)(89,"span",8),i(90,"\u{1F4C9}"),e(),i(91," REDUCCI\xD3N DEL CONSUMO - Contenido GRI: 302-4 "),e(),t(92,"h3",12),i(93,"Reducci\xF3n del consumo de energ\xEDa el\xE9ctrica (Grupo Auteco)"),e(),t(94,"div",13)(95,"table",29)(96,"thead")(97,"tr")(98,"th"),i(99,"Consumo total de energ\xEDa el\xE9ctrica a\xF1o actual (kWh)"),e(),t(100,"th"),i(101,"Consumo total de energ\xEDa el\xE9ctrica a\xF1o anterior (kWh)"),e(),t(102,"th"),i(103,"% de variaci\xF3n"),e()()(),t(104,"tbody")(105,"tr")(106,"td"),u(107,"input",30),e(),t(108,"td"),u(109,"input",31),e(),t(110,"td",27)(111,"span",21),i(112),f(113,"number"),e()()()()()(),t(114,"div",23)(115,"span",8),i(116,"\u{1F50B}"),e(),i(117," CONSUMO DE ENERG\xCDA AUTECO BLUE - Contenido GRI: 302-1 "),e(),t(118,"h3",12),i(119,"Consumo de energ\xEDa dentro de la organizaci\xF3n (Auteco BLUE)"),e(),t(120,"div",13)(121,"table",14)(122,"thead")(123,"tr")(124,"th"),i(125,"Tipo de fuente"),e(),t(126,"th"),i(127,"Tipo de energ\xEDa consumida"),e(),t(128,"th"),i(129,"Eneg\xEDa consumida"),e(),t(130,"th"),i(131,"Consumo de energ\xEDa (GJ)"),e(),t(132,"th",15),i(133,"Acciones"),e()()(),t(134,"tbody",32),_(135,ee,11,6,"tr",17),t(136,"tr",18)(137,"td",19)(138,"strong"),i(139,"TOTAL"),e()(),t(140,"td",20)(141,"span",21),i(142),f(143,"number"),e()(),u(144,"td"),e()()()(),t(145,"button",22),g("click",function(){return n.agregarFilaConsumoBLUE()}),i(146," \u2795 Agregar fuente de energ\xEDa BLUE "),e(),t(147,"h3",33),i(148,"Reducci\xF3n del consumo de energ\xEDa el\xE9ctrica (Auteco BLUE)"),e(),t(149,"div",13)(150,"table",29)(151,"thead")(152,"tr")(153,"th"),i(154,"Consumo total de energ\xEDa el\xE9ctrica a\xF1o actual (kWh)"),e(),t(155,"th"),i(156,"Consumo total de energ\xEDa el\xE9ctrica a\xF1o anterior (kWh)"),e(),t(157,"th"),i(158,"% de variaci\xF3n"),e()()(),t(159,"tbody")(160,"tr")(161,"td"),u(162,"input",34),e(),t(163,"td"),u(164,"input",35),e(),t(165,"td",27)(166,"span",21),i(167),f(168,"number"),e()()()()()(),t(169,"div",23)(170,"span",8),i(171,"\u{1F4A1}"),e(),i(172," EFICIENCIA ENERG\xC9TICA - Contenido GRI: N/A "),e(),t(173,"h3",12),i(174,"Acciones implementadas de eficiencia energ\xE9tica"),e(),t(175,"div",13)(176,"table",36)(177,"thead")(178,"tr")(179,"th"),i(180,"Acci\xF3n implementada"),e(),t(181,"th"),i(182,"Descripci\xF3n de las acciones y su objetivo"),e(),t(183,"th"),i(184,"Descripci\xF3n de los resultados obtenidos"),e(),t(185,"th"),i(186,"Ahorros de energ\xEDa generados (kwh)"),e(),t(187,"th",15),i(188,"Acciones"),e()()(),t(189,"tbody",37),_(190,ie,11,6,"tr",17),t(191,"tr",18)(192,"td",19)(193,"strong"),i(194,"TOTAL"),e()(),t(195,"td",20)(196,"span",21),i(197),f(198,"number"),e()(),u(199,"td"),e()()()(),t(200,"button",22),g("click",function(){return n.agregarFilaEficiencia()}),i(201," \u2795 Agregar acci\xF3n de eficiencia "),e(),t(202,"input",38),g("click",function(){return n.submitFormEficienciaEnergetica()}),e()()()()),l&2&&(o(9),r("hidden",!n.eficienciaEnergetica),o(),r("formGroup",n.datoseficienciaenergetica),o(33),r("ngForOf",n.consumoEnergiaGrupo.controls),o(7),b(h(51,17,n.totalConsumoEnergiaGrupo,"1.2-2")),o(24),r("ngClass",n.getFieldClass(n.datoseficienciaenergetica,"consumo_total_energia")),o(2),r("ngClass",n.getFieldClass(n.datoseficienciaenergetica,"unidades_producidas")),o(3),b(h(80,20,n.consumoPorUnidadGrupo,"1.2-2")),o(28),r("ngClass",n.getFieldClass(n.datoseficienciaenergetica,"consumo_actual_grupo")),o(2),r("ngClass",n.getFieldClass(n.datoseficienciaenergetica,"consumo_anterior_grupo")),o(3),y("",h(113,23,n.porcentajeVariacionGrupo,"1.1-1"),"%"),o(23),r("ngForOf",n.consumoEnergiaBLUE.controls),o(7),b(h(143,26,n.totalConsumoEnergiaBLUE,"1.2-2")),o(20),r("ngClass",n.getFieldClass(n.datoseficienciaenergetica,"consumo_actual_blue")),o(2),r("ngClass",n.getFieldClass(n.datoseficienciaenergetica,"consumo_anterior_blue")),o(3),y("",h(168,29,n.porcentajeVariacionBLUE,"1.1-1"),"%"),o(23),r("ngForOf",n.accionesEficiencia.controls),o(7),b(h(198,32,n.totalAhorrosEnergia,"1.2-2")))},dependencies:[I,A,T,B,U,z,q,V,j,k,w,O,W,P,M]})}}return m})();export{de as EficienciaEnergeticaComponent};
