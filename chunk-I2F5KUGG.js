import{a as Q}from"./chunk-2PSR7T7J.js";import{a as k,b as d,c as P,d as M,e as V,f as $,g as L,i as U,j,k as q,l as Y,r as H,s as z,t as J,u as K}from"./chunk-IAQZ57CQ.js";import{B as s,C as h,F,G as p,I as m,K as i,L as t,M as f,P as B,Q as g,R as c,S as n,T as I,U as b,W as y,Y as N,Z as D,a as v,b as S,c as _,da as T,ea as A,fa as R,ga as w,ha as O,na as G,s as C,w as x,x as E}from"./chunk-ACHKL7EZ.js";function Z(a,u){if(a&1&&(i(0,"span",35),n(1),t()),a&2){let e=c().$implicit,r=c();s(),b(" ",r.getErrorMessage(e,"nombre_beneficio")," ")}}function ee(a,u){if(a&1&&(i(0,"span",35),n(1),t()),a&2){let e=c().$implicit,r=c();s(),b(" ",r.getErrorMessage(e,"numero_colaboradores")," ")}}function te(a,u){if(a&1&&(i(0,"span",35),n(1),t()),a&2){let e=c().$implicit,r=c();s(),b(" ",r.getErrorMessage(e,"recursos_invertidos")," ")}}function ie(a,u){if(a&1){let e=B();i(0,"button",36),g("click",function(){x(e);let o=c().index,l=c();return E(l.eliminarFilaBeneficio(o))}),n(1," \u274C "),t()}}function oe(a,u){if(a&1&&(i(0,"tr",29)(1,"td"),f(2,"input",30),p(3,Z,2,1,"span",27),t(),i(4,"td"),f(5,"input",31),p(6,ee,2,1,"span",27),t(),i(7,"td"),f(8,"input",32),p(9,te,2,1,"span",27),t(),i(10,"td",33),p(11,ie,2,0,"button",34),t()()),a&2){let e=u.$implicit,r=u.index,o=c();m("formGroupName",r),s(2),m("ngClass",o.getFieldClass(e,"nombre_beneficio")),s(),m("ngIf",o.shouldShowError(e,"nombre_beneficio")),s(2),m("ngClass",o.getFieldClass(e,"numero_colaboradores")),s(),m("ngIf",o.shouldShowError(e,"numero_colaboradores")),s(2),m("ngClass",o.getFieldClass(e,"recursos_invertidos")),s(),m("ngIf",o.shouldShowError(e,"recursos_invertidos")),s(2),m("ngIf",o.beneficios.length>1)}}function ne(a,u){if(a&1&&(i(0,"span",35),n(1),t()),a&2){let e=c();s(),b(" ",e.getErrorMessage(e.datosbienestar,"total_salarios")," ")}}var fe=(()=>{class a extends J{constructor(e,r,o,l){super(),this.formBuilder=e,this.formService=r,this.formDataService=o,this.router=l,this.bienestar=!0,this.datosbienestar=new V({}),this.filesToUpload=new Map,this.totalColaboradoresBeneficios=0,this.totalRecursosInvertidos=0,this.totalSalarios=0}ngOnInit(){this.datosbienestar=this.formBuilder.group({beneficios:this.formBuilder.array([]),total_salarios:["",[d.required,d.min(0)]]}),this.agregarFilaBeneficio(),this.datosbienestar.valueChanges.subscribe(()=>{this.calcularTotales()}),this.calcularTotales()}get beneficios(){return this.datosbienestar.get("beneficios")}agregarFilaBeneficio(){let e=this.formBuilder.group({nombre_beneficio:["",d.required],numero_colaboradores:["",[d.required,d.min(0)]],recursos_invertidos:["",[d.required,d.min(0)]]});e.valueChanges.subscribe(()=>this.calcularTotales()),this.beneficios.push(e)}eliminarFilaBeneficio(e){this.beneficios.removeAt(e),this.calcularTotales()}calcularTotales(){this.totalColaboradoresBeneficios=this.beneficios.controls.reduce((e,r)=>e+(Number(r.get("numero_colaboradores")?.value)||0),0),this.totalRecursosInvertidos=this.beneficios.controls.reduce((e,r)=>e+(Number(r.get("recursos_invertidos")?.value)||0),0),this.totalSalarios=Number(this.datosbienestar.get("total_salarios")?.value)||0}getNumericValue(e){return Number(this.datosbienestar.get(e)?.value)||0}onFileSelected(e,r){let o=e.target.files[0];o&&(this.filesToUpload.set(r,o),console.log(`Archivo seleccionado: ${o.name} para ${r}`))}convertFileToBase64(e){return _(this,null,function*(){return new Promise((r,o)=>{let l=new FileReader;l.onload=()=>r(l.result),l.onerror=o,l.readAsDataURL(e)})})}submitFormBienestar(){return _(this,null,function*(){this.markFormGroupTouched(this.datosbienestar),this.datosbienestar.valid?(console.log("\u2705 Formulario Bienestar v\xE1lido"),yield this.sendAttachment()):(console.log("\u274C Formulario Bienestar inv\xE1lido"),this.scrollToFirstError(),alert("Por favor, complete todos los campos obligatorios"))})}sendAttachment(){return _(this,null,function*(){let e=[];for(let[l,W]of this.filesToUpload.entries()){console.log("\u{1F4CE} Procesando archivo:",l);let X=yield this.convertFileToBase64(W);e.push({fileName:l,fileData:X})}let r=this.formDataService.getDatosIniciales(),o=S(v({},this.datosbienestar.value),{totales:{beneficios:{colaboradores:this.totalColaboradoresBeneficios,recursos_invertidos:this.totalRecursosInvertidos},salarios:this.totalSalarios},fecha_reporte:new Date().toISOString()});console.log("\u{1F4CA} Datos a enviar:",o),this.formService.upload(e,r,null,null,null,null,null,null,null,o).subscribe({next:l=>{console.log("\u2705 Datos enviados exitosamente:",l),this.formDataService.clearDatosIniciales(),this.router.navigate(["/confirmacion"])},error:l=>{console.error("\u274C Error al enviar:",l),alert("Hubo un error al enviar los datos. Por favor, intente nuevamente.")}})})}static{this.\u0275fac=function(r){return new(r||a)(h(H),h(Q),h(K),h(G))}}static{this.\u0275cmp=C({type:a,selectors:[["app-bienestar"]],standalone:!0,features:[F,y],decls:78,vars:10,consts:[[1,"form-header"],[1,"header-content"],[1,"header-text"],["src","assets/auteco-logo.png","alt","Logo Empresa",1,"logo-empresa"],["id","msform"],[1,"border-purple",3,"hidden"],[3,"ngSubmit","formGroup"],[1,"section-header"],[1,"icon"],[1,"fs-subtitle"],[1,"info-box"],[1,"subsection-header"],[1,"table-subtitle"],[1,"table-container"],[1,"gri-table","bienestar-table"],[1,"acciones-col"],["formArrayName","beneficios"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"totales-row"],[1,"total-label"],[1,"total-cell"],[1,"resultado-total"],["type","button",1,"btn-agregar-fila",3,"click"],[1,"subsection-header",2,"margin-top","50px"],[1,"gri-table","bienestar-table-simple"],[1,"dato-label"],["type","number","formControlName","total_salarios","placeholder","0",3,"ngClass"],["class","error-text",4,"ngIf"],["type","button","value","GUARDAR Y ENVIAR",1,"action-button","success",3,"click"],[3,"formGroupName"],["type","text","formControlName","nombre_beneficio","placeholder","Ej: Seguro m\xE9dico, bonos, etc.",3,"ngClass"],["type","number","formControlName","numero_colaboradores","placeholder","0",3,"ngClass"],["type","number","formControlName","recursos_invertidos","placeholder","0",3,"ngClass"],[1,"acciones-cell"],["type","button","class","btn-eliminar","title","Eliminar fila",3,"click",4,"ngIf"],[1,"error-text"],["type","button","title","Eliminar fila",1,"btn-eliminar",3,"click"]],template:function(r,o){r&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),f(4,"img",3),n(5," Plataforma de Gesti\xF3n - Informe de Sostenibilidad"),t(),i(6,"p"),n(7,"Sistema de recolecci\xF3n de datos para reportes GRI"),t()()()(),i(8,"form",4)(9,"fieldset",5)(10,"form",6),g("ngSubmit",function(){return o.submitFormBienestar()}),i(11,"div",7)(12,"span",8),n(13,"\u{1F4BC}"),t(),i(14,"h2"),n(15,"Portafolio de Beneficios para Colaboradores"),t()(),i(16,"p",9),n(17," Complete la informaci\xF3n sobre beneficios para colaboradores y salarios pagados "),t(),i(18,"div",10)(19,"strong"),n(20,"\u2139\uFE0F INSTRUCCIONES:"),t(),n(21," Agregue filas seg\xFAn sea necesario para cada beneficio. Los totales se calcular\xE1n autom\xE1ticamente. "),t(),i(22,"div",11)(23,"span",8),n(24,"\u{1F381}"),t(),n(25," PORTAFOLIO DE BENEFICIOS PARA COLABORADORES - Contenido GRI: 401-2 "),t(),i(26,"h3",12),n(27,"Prestaciones para los empleados a tiempo completo que no se dan a los empleados a tiempo parcial o temporal"),t(),i(28,"div",13)(29,"table",14)(30,"thead")(31,"tr")(32,"th"),n(33,"Nombre del beneficio"),t(),i(34,"th"),n(35,"N\xFAmero de colaboradores beneficiados"),t(),i(36,"th"),n(37,"Recursos invertidos"),t(),i(38,"th",15),n(39,"Acciones"),t()()(),i(40,"tbody",16),p(41,oe,12,8,"tr",17),i(42,"tr",18)(43,"td",19)(44,"strong"),n(45,"Total"),t()(),i(46,"td",20)(47,"span",21),n(48),t()(),i(49,"td",20)(50,"span",21),n(51),N(52,"number"),t()(),f(53,"td"),t()()()(),i(54,"button",22),g("click",function(){return o.agregarFilaBeneficio()}),n(55," \u2795 Agregar beneficio "),t(),i(56,"div",23)(57,"span",8),n(58,"\u{1F4B0}"),t(),n(59," SALARIOS Y COMPENSACIONES - Contenido GRI: N/A "),t(),i(60,"h3",12),n(61,"Salarios pagados y otras compensaciones laborales"),t(),i(62,"div",13)(63,"table",24)(64,"thead")(65,"tr")(66,"th"),n(67,"Dato solicitado"),t(),i(68,"th"),n(69,"Valor"),t()()(),i(70,"tbody")(71,"tr")(72,"td",25),n(73,"Total de salarios pagados y otras compensaciones ($)"),t(),i(74,"td"),f(75,"input",26),p(76,ne,2,1,"span",27),t()()()()(),i(77,"input",28),g("click",function(){return o.submitFormBienestar()}),t()()()()),r&2&&(s(9),m("hidden",!o.bienestar),s(),m("formGroup",o.datosbienestar),s(31),m("ngForOf",o.beneficios.controls),s(7),I(o.totalColaboradoresBeneficios),s(3),b("$ ",D(52,7,o.totalRecursosInvertidos,"1.0-0"),""),s(24),m("ngClass",o.getFieldClass(o.datosbienestar,"total_salarios")),s(),m("ngIf",o.shouldShowError(o.datosbienestar,"total_salarios")))},dependencies:[O,T,A,R,w,z,$,k,L,P,M,U,Y,j,q]})}}return a})();export{fe as BienestarComponent};
